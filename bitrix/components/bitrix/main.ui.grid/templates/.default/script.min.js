function BxUniversalGrid(t){"use strict";this.oColsMeta={};this.oColsNames={};this.customNames={};this.columnsSizes={};this.oEditData={};this.oSaveData={};this.oOptions={};this.oVisibleCols={};this.vars={};this.menu=null;this.settingsMenu=[];this.filterMenu=[];this.checkBoxCount=0;this.bColsChanged=false;this.bViewsChanged=false;this.oFilterRows={};this.activeRow=null;this.hasActions=false;this.editMode=false;this.resizeMeta={};this.table_id=t+"_table";this.grid_id=t;var e=this;var i=null;var n=false;this.InitTable=function(){i=BX.Main.gridManager.getById(e.grid_id).instance;this.checkBoxCount=0;var t=i.getTable();if(!t||t.rows.length<1||t.rows[0].cells.length<1){return}var n=t.rows[0].cells;for(var s=0;s<n.length;s++){if(BX.hasClass(n[s],"main-grid-cell-action")||BX.hasClass(n[s],"main-grid-cell-checkbox")){n[s].__fixed=true;continue}var a=BX.findChildByClassName(n[s],"main-grid-cell-head-container",false);BX.addClass(a,"main-grid-cell-head-dragable");BX.removeClass(n[s],"main-grid-cell-sortable")}this.initResizeMeta();this.toogleFader();BX.bind(window,"resize",BX.delegate(this.toogleFader,this));BX.bind(t.parentNode,"scroll",this.toogleFader);if(i.getParam("ALLOW_COLUMNS_RESIZE")){for(var s=0;s<n.length;s++){if(n[s].__fixed){continue}var r=BX.findChildByClassName(n[s],"main-grid-resize-button");if(r){r.onbxdragstart=e.resizeColumnStart;r.onbxdragstop=e.resizeColumnStop;r.onbxdrag=e.resizeColumn;jsDD.registerObject(r)}}var o=function(){var t=i.getPinHeader().getFixedTable();var n=BX.findChild(t,{"class":"main-grid-resize-button"},true,true);n.forEach(function(t){t.onbxdragstart=e.resizeColumnStart;t.onbxdragstop=e.resizeColumnStop;t.onbxdrag=e.resizeColumn;jsDD.registerObject(t)})};BX.addCustomEvent(window,"Grid::headerPinned",o);BX.addCustomEvent(window,"Grid::updated",o)}};this.CheckColumn=function(t,e){var n;var s=this.menu.GetMenuByItemId(e.id);var a=!(s.GetItemInfo(e).ICON=="checked");s.SetItemIcon(e,a?"checked":"");if(t){n=i.getUserOptions().getCurrentOptions().columns.split(",");if(BX.type.isArray(n)&&BX.type.isNotEmptyString(t)){if(n.some(function(e){return e===t})){n=n.filter(function(e){return e!==t});BX.removeClass("menu_"+i.getContainerId()+"_columns_item_","checked")}else{n.unshift(t);BX.addClass("menu_"+i.getContainerId()+"_columns_item_","checked")}}i.tableFade();i.getUserOptions().setColumns(n,function(){i.reloadTable();BX.onCustomEvent(i.getContainer(),"Grid::columnsChanged",[i])})}};this.reinitColumnSize=function(t,e){var i=this.GetColumnId(t);if(i!==false){var n=BX(this.table_id);var s=n.offsetWidth;var a=n.rows[0].cells[i];var r=BX.findChildByClassName(a,"main-grid-cell-head-container",false);r.style.height="";BX.removeClass(r,"main-grid-cell-head-dragable");a.style.width="";a.style.width=a.offsetWidth+"px";BX.addClass(r,"main-grid-cell-head-dragable");r.style.height=n.rows[0].cells[0].clientHeight+"px";if(e){a.setAttribute("data-resize",1)}}};this.initResizeMeta=function(){var t=i.getTable();var e=t.rows[0].cells;this.resizeMeta.fixed=0;this.resizeMeta.minPx=t.offsetWidth;var n=false;for(var s=0;s<e.length;s++){var a=BX.width(e[s]);if(e[s].__fixed){this.resizeMeta.fixed+=a;continue}if(a>0){var r=e[s].getAttribute("data-name");if(this.resizeMeta.columns[r]!=a){n=true}this.resizeMeta.columns[r]=a}}if(n){this.resizeMeta.expand=1}};this.reinitResizeMeta=function(){var t=BX(e.table_id);var i=t.rows[0].cells;for(var n=0;n<i.length;n++){if(i[n].__fixed){continue}if(i[n].offsetWidth>0){var s=i[n].getAttribute("data-name");e.resizeMeta.columns[s]=i[n].offsetWidth}}var a=t.offsetWidth;var r=t.parentNode.clientWidth;e.resizeMeta.minPx=a;e.resizeMeta.expand=a<r?a/r:1;e.saveColumnsSizes()};this.toogleFader=function(){var t=BX.Main.gridManager.getById(e.grid_id).instance;var i=t.getTable();var n=t.getScrollContainer();if(i.offsetWidth>n.clientWidth){if(n.scrollLeft>0){BX.addClass(n.parentNode,"main-grid-fade-left")}else{BX.removeClass(n.parentNode,"main-grid-fade-left")}if(i.offsetWidth>n.scrollLeft+n.clientWidth){BX.addClass(n.parentNode,"main-grid-fade-right")}else{BX.removeClass(n.parentNode,"main-grid-fade-right")}}else{BX.removeClass(n.parentNode,"main-grid-fade-left");BX.removeClass(n.parentNode,"main-grid-fade-right")}};this.OnRowContext=function(t){if(!e.menu){return}if(!t){t=window.event}if(!phpVars.opt_context_ctrl&&t.ctrlKey||phpVars.opt_context_ctrl&&!t.ctrlKey){return}var i;if(t.target){i=t.target}else if(t.srcElement){i=t.srcElement}var n=i;while(n&&!(n.tagName&&n.tagName.match(/(th|td)/i)&&n.oncontextmenu)){n=BX.findParent(n,{tagName:/(th|td)/i})}var s=null;if(n&&n.oncontextmenu){s=n.oncontextmenu();s[s.length]={SEPARATOR:true}}n=i;while(n&&!(n.tagName&&n.tagName.toUpperCase()==="TR"&&n.oncontextmenu)){n=jsUtils.FindParentObject(n,"tr")}var a=e.menu;a.PopupHide();e.activeRow=n;if(e.activeRow&&!BX.hasClass(n,"main-grid-row-head")){e.activeRow.className+=" active"}a.OnClose=function(){if(e.activeRow){e.activeRow.className=e.activeRow.className.replace(/\s*active/i,"");e.activeRow=null}};var r=BX.util.array_merge(s,n.oncontextmenu());if(r.length==0){return}a.SetItems(r);a.BuildItems();var o=jsUtils.GetWindowScrollPos();var l=t.clientX+o.scrollLeft;var d=t.clientY+o.scrollTop;var h={};h.left=h.right=l;h.top=h.bottom=d;a.PopupShow(h);t.returnValue=false;if(t.preventDefault){t.preventDefault()}};this.ShowActionMenu=function(t,i){e.menu.PopupHide();e.activeRow=jsUtils.FindParentObject(t,"tr");if(e.activeRow){e.activeRow.className+=" active"}var n=BX("datarow_"+this.table_id+"_"+i);var s=BX.data(n,"actions");if(n&&s){var a=JSON.parse(s);if(a&&a.length>0){e.menu.ShowMenu(t,a,false,false,function(){if(e.activeRow){e.activeRow.className=e.activeRow.className.replace(/\s*active/i,"");e.activeRow=null}})}}};this.SelectRow=function(t,e){e=e?e:window.event;var i=BX.findParent(t,{className:"main-grid-row"});var s=document.getElementById(this.table_id+"_selected_span");var a=parseInt(s.innerHTML);var r=[i];if(e&&e.shiftKey&&n&&n!==i){var o=document.getElementById(this.table_id);for(var l=Math.min(n.rowIndex,i.rowIndex)+1;l<Math.max(n.rowIndex,i.rowIndex);l++){r.push(o.rows[l])}if(BX.findChildByClassName(n.cells[0],"main-grid-checkbox").checked){r.push(n)}}for(var l in r){var d=BX.findChildByClassName(r[l].cells[0],"main-grid-checkbox");if(d&&(t===d||d.checked!==t.checked)){d.checked=t.checked;if(t.checked){BX.addClass(r[l],"main-grid-row-checked");a++}else{BX.removeClass(r[l],"main-grid-row-checked");a--}}}s.innerHTML=a.toString();var h=BX(this.table_id+"_check_all");h.checked=this.checkBoxCount>0&&a===this.checkBoxCount;n=i};this.SelectAllRows=function(t){};this.EnableActions=function(){var t=document.forms["form_"+this.table_id];if(!t)return;var e=this.IsActionEnabled();var i=this.IsActionEnabled("edit");var n=BX("edit_button_"+this.table_id);var s=BX("delete_button_"+this.table_id);if(t.apply){t.apply.disabled=!e;BX[e?"removeClass":"addClass"](t.apply,"webform-button-disable")}if(n)BX[i?"removeClass":"addClass"](n,"main-grid-control-panel-action-icon-disable");if(s)BX[e?"removeClass":"addClass"](s,"main-grid-control-panel-action-icon-disable")};this.IsActionEnabled=function(t){var e=document.forms["form_"+this.table_id];if(!e)return;var i=false;var n=document.getElementById(this.table_id+"_selected_span");if(n&&parseInt(n.innerHTML)>0)i=true;var s=e["action_all_rows_"+this.table_id];if(t=="edit")return!(s&&s.checked)&&i;else return s&&s.checked||i};this.SwitchActionButtons=function(t){var e=BX("bx_grid_"+this.table_id+"_action_buttons");var i=e;while(i=jsUtils.FindNextSibling(i,"div"))i.style.display=t?"none":"";e.style.display=t?"":"none"};this.ActionEdit=function(){if(this.IsActionEnabled("edit")){var t=document.forms["form_"+this.table_id];if(!t)return;this.editMode=true;this.SwitchActionButtons(true);var i=t["ID[]"];if(!i.length)i=new Array(i);for(var n=0;n<i.length;n++){var s=i[n];if(s.checked){var a=jsUtils.FindParentObject(s,"tr");BX.denyEvent(a,"dblclick");var r=jsUtils.FindParentObject(s,"td");r=jsUtils.FindNextSibling(r,"td");if(BX.hasClass(r,"main-grid-cell-action"))r=jsUtils.FindNextSibling(r,"td");var o=s.value;this.oSaveData[o]={};for(var l in this.oVisibleCols){if(this.oVisibleCols[l]==true&&this.oColsMeta[l].editable==true&&this.oEditData[o][l]!==false){this.oSaveData[o][l]=r.innerHTML;r.innerHTML="";var d=this.oEditData[o][l];var h="FIELDS["+o+"]["+l+"]";var c=BX.create("SPAN",{props:{className:"main-grid-cell-content"}});switch(this.oColsMeta[l].type){case"checkbox":c.appendChild(BX.create("INPUT",{props:{type:"hidden",name:h,value:"N"}}));c.appendChild(BX.create("INPUT",{props:{className:"main-grid-cell-content-edit",type:"checkbox",name:h,value:"Y",checked:d=="Y",defaultChecked:d=="Y"}}));break;case"list":var u=[];for(var f in this.oColsMeta[l].items){u[u.length]=BX.create("OPTION",{props:{value:f,selected:f==d},text:this.oColsMeta[l].items[f]})}c.appendChild(BX.create("SELECT",{props:{className:"main-grid-cell-content-edit",name:h},children:u}));break;case"date":var g={props:{className:"main-grid-cell-content-edit",type:"text",name:h,value:d,size:this.oColsMeta[l].size?this.oColsMeta[l].size:20},style:{paddingRight:"20px"}};if(this.oColsMeta[l].size)g.props.size=this.oColsMeta[l].size;else g.style.width="100%";c.appendChild(BX.create("INPUT",g));c.appendChild(BX.create("A",{props:{href:"javascript:void(0);",title:this.vars.mess.calend_title},style:{border:"none",position:"relative",right:"22px"},children:[BX.create("IMG",{props:{className:"calendar-icon",src:this.vars.calendar_image,alt:this.vars.mess.calend_title,onclick:function(t){return function(){BX.calendar({node:this,field:t,bTime:true,currentTime:e.vars.server_time})}}(h),onmouseover:function(){BX.addClass(this,"calendar-icon-hover")},onmouseout:function(){BX.removeClass(this,"calendar-icon-hover")}}})]}));BX.addClass(c,"main-grid-cell-text-line");break;case"textarea":var g={props:{className:"main-grid-cell-content-edit",name:h},text:d};if(this.oColsMeta[l].cols)g.props.cols=this.oColsMeta[l].cols;else g.style={width:"100%"};if(this.oColsMeta[l].rows)g.props.rows=this.oColsMeta[l].rows;if(this.oColsMeta[l].maxlength)g.props.maxLength=this.oColsMeta[l].maxlength;c.appendChild(BX.create("TEXTAREA",g));break;case"file":c.appendChild(BX.create("INPUT",{props:{className:"main-grid-cell-content-edit",type:"file",name:h}}));break;default:var g={props:{className:"main-grid-cell-content-edit",type:"text",name:h,value:d}};if(this.oColsMeta[l].size)g.props.size=this.oColsMeta[l].size;else g.style={width:"100%"};if(this.oColsMeta[l].maxlength)g.props.maxLength=this.oColsMeta[l].maxlength;c.appendChild(BX.create("INPUT",g));break}r.appendChild(c)}r=jsUtils.FindNextSibling(r,"td")}}s.disabled=true}BX(this.table_id+"_check_all").disabled=true;t.elements["action_button_"+this.table_id].value="edit"}};this.ActionCancel=function(){var t=document.forms["form_"+this.table_id];if(!t)return;this.editMode=false;this.SwitchActionButtons(false);var e=t["ID[]"];if(!e.length)e=new Array(e);for(var i=0;i<e.length;i++){var n=e[i];if(n.checked){var s=jsUtils.FindParentObject(n,"tr");BX.allowEvent(s,"dblclick");var a=jsUtils.FindParentObject(n,"td");a=jsUtils.FindNextSibling(a,"td");if(BX.hasClass(a,"main-grid-cell-action"))a=jsUtils.FindNextSibling(a,"td");var r=n.value;for(var o in this.oVisibleCols){if(typeof this.oSaveData[r][o]!="undefined")a.innerHTML=this.oSaveData[r][o];a=jsUtils.FindNextSibling(a,"td")}}}this.toggleCheckboxes();t.elements["action_button_"+this.table_id].value=""};this.ActionDelete=function(){var t=document.forms["form_"+this.table_id];if(!t)return;t.elements["action_button_"+this.table_id].value="delete";BX.submit(t)};this.ForAllClick=function(t){if(t.checked&&!confirm(this.vars.mess.for_all_confirm)){t.checked=false;return}var e=t.form["ID[]"];if(e){if(!e.length)e=new Array(e);for(var i=0;i<e.length;i++){if(e[i].getAttribute("data-disabled"))continue;e[i].disabled=t.checked}}BX(this.table_id+"_check_all").disabled=t.checked;this.editMode=t.checked;this.EnableActions()};this.Sort=function(t,i,n,s,a){var r;if(n==""){var o=null,l=false;if(a.length>0)o=a[0];if(!o)o=window.event;if(o)l=o.ctrlKey;r=l?s=="acs"?"desc":"asc":s}else if(n=="asc")r="desc";else r="asc";t+=r;BX.ajax.get("/bitrix/components"+e.vars.component_path+"/settings.ajax.php?GRID_ID="+e.table_id+"&action=savesort&by="+i+"&order="+r+"&sessid="+e.vars.sessid,function(){e.Reload(t)})};this.GetColumnId=function(t){var e=false;var i=BX(this.table_id);for(var n=0;n<i.rows[0].cells.length;n++){if(i.rows[0].cells[n].getAttribute("data-name")==t){e=n;break}}return e};this.animation=function(t,i,n,s){e.animation.stop(t);var a=function(){t.__animation.step++;var i=t.__animation;for(var n in i.props){var s=i.props[n];t.style[n]=s.from*1+(s.to-s.from)*i.step/i.steps+s.unit}if(i.step>=i.steps)e.animation.stop(t)};t.__animation={props:i,steps:Math.round(n/10),step:0,callback:s};t.__animation.interval=setInterval(a,n/t.__animation.steps)};this.animation.stop=function(t){if(t.__animation&&t.__animation.interval){t.__animation.interval=clearInterval(t.__animation.interval);if(t.__animation.callback)t.__animation.callback()}};this.toogleColumnCells=function(t,i,n){var s=BX(e.table_id);for(var a=0;a<s.rows.length;a++){var r=s.rows[a].cells;if(r[t]){r[t].style.display=i?"":"none";var o=BX.findChildByClassName(r[t],"main-grid-cell-content",false);if(o&&o.style)o.style.width=n?o.clientWidth+"px":""}}};this.toggleCheckboxes=function(){var t=BX(this.table_id);for(var e=1;e<t.rows.length;e++){if(BX.hasClass(t.rows[e],"main-grid-data-row")){var i=BX.findChildByClassName(t.rows[e].cells[0],"main-grid-checkbox");var n=i.value;var s=false;if(this.hasActions){if(!i.getAttribute("data-disabled"))s=true}else if(typeof this.oEditData[n]!="undefined"){for(var a in this.oVisibleCols){if(this.oVisibleCols[a]&&this.oColsMeta[a].editable&&this.oEditData[n][a]!==false)s=true}}if(s){if(i.getAttribute("data-disabled"))this.checkBoxCount++;i.disabled=this.editMode;i.removeAttribute("data-disabled")}else{if(!i.getAttribute("data-disabled"))this.checkBoxCount--;i.disabled=true;i.setAttribute("data-disabled",1)}}}if(this.checkBoxCount==0){BX(this.table_id+"_check_all").disabled=true;if(!this.editMode){for(var e=1;e<t.rows.length;e++){if(BX.hasClass(t.rows[e],"main-grid-data-row")){var i=BX.findChildByClassName(t.rows[e].cells[0],"main-grid-checkbox");if(i.checked){i.checked=false;this.SelectRow(i)}}}BX(this.table_id+"_action_bar_fade").style.display=""}}else{if(!this.editMode)BX(this.table_id+"_check_all").disabled=false;BX(this.table_id+"_action_bar_fade").style.display="none"}};this.SaveColumns=function(t,i){var n="";if(t){n=t}else{if(!e.bColsChanged)return;for(var s in e.oVisibleCols)if(e.oVisibleCols[s])n+=(n!=""?",":"")+s}e.oOptions.views[e.oOptions.current_view].columns=n;if(e.vars.user_authorized){BX.ajax.get("/bitrix/components"+e.vars.component_path+"/settings.ajax.php",{GRID_ID:e.table_id,action:"showcolumns",columns:n,sessid:e.vars.sessid},i)}};this.saveColumnsSizes=function(){i.getUserOptions().setColumnSizes(e.resizeMeta.columns,e.resizeMeta.expand)};this.Reload=function(t){var i=BX.Main.gridManager.getById(e.grid_id).instance;var n=i.getScrollContainer();var s;jsDD.Disable();if(!t){t=this.vars.current_url[this.vars.current_url.length-1]}if(this.vars.ajax.AJAX_ID!=""){s=BX.ajax.insertToNode(t+(t.indexOf("?")==-1?"?":"&")+"bxajaxid="+this.vars.ajax.AJAX_ID,"comp_"+this.vars.ajax.AJAX_ID);s.onprogress=function(){e.scrollContainerLeft=n.scrollLeft};s.onload=function(){i.getScrollContainer().scrollLeft=e.scrollContainerLeft;i.reloadTable()}}else{window.location=t}};this.SetView=function(t){var i=e.oOptions.views[t].saved_filter;var n=i&&e.oOptions.filters[i]?function(){e.ApplyFilter(i)}:function(){e.Reload()};BX.ajax.get("/bitrix/components"+e.vars.component_path+"/settings.ajax.php?GRID_ID="+e.table_id+"&action=setview&view_id="+t+"&sessid="+e.vars.sessid,n)};this.EditCurrentView=function(){this.ShowSettings(this.oOptions.views[this.oOptions.current_view],function(){e.SaveSettings(e.oOptions.current_view,true)})};this.AddView=function(){var t="view_"+Math.round(Math.random()*1e6);var i={};for(var n in this.oOptions.views[this.oOptions.current_view])i[n]=this.oOptions.views[this.oOptions.current_view][n];i.name=this.vars.mess.viewsNewView;this.ShowSettings(i,function(){var i=e.SaveSettings(t);e.oOptions.views[t]={name:i.name,columns:i.columns,sort_by:i.sort_by,sort_order:i.sort_order,page_size:i.page_size,saved_filter:i.saved_filter,custom_names:i.custom_names,columns_sizes:i.columns_sizes};e.bViewsChanged=true;var n=document["views_"+e.table_id];n.views_list.options[n.views_list.length]=new Option(i.name!=""?i.name:e.vars.mess.viewsNoName,t,true,true)})};this.EditView=function(t){this.ShowSettings(this.oOptions.views[t],function(){var i=e.SaveSettings(t);e.oOptions.views[t]={name:i.name,columns:i.columns,sort_by:i.sort_by,sort_order:i.sort_order,page_size:i.page_size,saved_filter:i.saved_filter,custom_names:i.custom_names,columns_sizes:i.columns_sizes};e.bViewsChanged=true;var n=document["views_"+e.table_id];n.views_list.options[n.views_list.selectedIndex].text=i.name!=""?i.name:e.vars.mess.viewsNoName})};this.DeleteView=function(t){if(!confirm(this.vars.mess.viewsDelete))return;var i=document["views_"+this.table_id];var n=i.views_list.selectedIndex;i.views_list.remove(n);i.views_list.selectedIndex=n<i.views_list.length?n:i.views_list.length-1;this.bViewsChanged=true;BX.ajax.get("/bitrix/components"+this.vars.component_path+"/settings.ajax.php?GRID_ID="+this.table_id+"&action=delview&view_id="+t+"&sessid="+e.vars.sessid)};this.ShowSettings=function(t,e){var i=false;if(!window["settingsDialog"+this.table_id]){window["settingsDialog"+this.table_id]=new BX.CDialog({content:'<form name="settings_'+this.table_id+'"></form>',title:this.vars.mess.settingsTitle,width:this.vars.settingWndSize.width,height:this.vars.settingWndSize.height,resize_id:"InterfaceGridSettingWnd"});i=true}window["settingsDialog"+this.table_id].ClearButtons();window["settingsDialog"+this.table_id].SetButtons([{title:this.vars.mess.settingsSave,action:function(){e();this.parentWindow.Close()}},BX.CDialog.prototype.btnCancel]);window["settingsDialog"+this.table_id].Show();var n=document["settings_"+this.table_id];if(i)n.appendChild(BX("view_settings_"+this.table_id));this.customNames=t.custom_names?t.custom_names:{};this.columnsSizes=t.columns_sizes?t.columns_sizes:{};n.view_name.focus();n.view_name.value=t.name;var s=[];if(t.columns!=""){s=t.columns.split(",")}else{for(var a in this.oVisibleCols){if(this.oVisibleCols[a])s[s.length]=a}}var r={},o;for(a=0,o=s.length;a<o;a++)r[s[a]]=true;jsSelectUtils.deleteAllOptions(n.view_all_cols);for(a in this.oColsNames){if(!r[a]){var l=this.customNames[a]?this.customNames[a]+" ("+this.oColsNames[a]+")":this.oColsNames[a];n.view_all_cols.options[n.view_all_cols.length]=new Option(l,a,false,false)}}jsSelectUtils.deleteAllOptions(n.view_cols);for(a in r){l=this.customNames[a]?this.customNames[a]+" ("+this.oColsNames[a]+")":this.oColsNames[a];n.view_cols.options[n.view_cols.length]=new Option(l,a,false,false)}n.reset_columns_sizes.checked=false;jsSelectUtils.selectOption(n.view_sort_by,t.sort_by);jsSelectUtils.selectOption(n.view_sort_order,t.sort_order);jsSelectUtils.selectOption(n.view_page_size,t.page_size);jsSelectUtils.deleteAllOptions(n.view_filters);n.view_filters.options[0]=new Option(this.vars.mess.viewsFilter,"");for(a in this.oOptions.filters)n.view_filters.options[n.view_filters.length]=new Option(this.oOptions.filters[a].name,a,a==t.saved_filter,a==t.saved_filter);if(n.set_default_settings){n.set_default_settings.checked=false;n.delete_users_settings.checked=false;n.delete_users_settings.disabled=true}n.up_btn.disabled=n.down_btn.disabled=n.rename_btn.disabled=n.add_btn.disabled=n.del_btn.disabled=true};this.RenameColumn=function(){var t=false;if(!window["renameDialog"+this.table_id]){window["renameDialog"+this.table_id]=new BX.CDialog({content:'<form name="rename_'+this.table_id+'"></form>',title:this.vars.mess.renameTitle,width:this.vars.renameWndSize.width,height:this.vars.renameWndSize.height,resize_id:"InterfaceGridRenameWnd",buttons:[{title:this.vars.mess.settingsSave,action:function(){var t=n.view_cols.value;var s=i.col_name.value;if(s.length>0){e.customNames[t]=s;s=s+" ("+e.oColsNames[t]+")"}else{s=e.oColsNames[t];delete e.customNames[t]}n.view_cols.options[n.view_cols.selectedIndex].text=s;this.parentWindow.Close()}},BX.CDialog.prototype.btnCancel]});t=true}window["renameDialog"+this.table_id].Show();var i=document["rename_"+this.table_id];var n=document["settings_"+this.table_id];if(t)i.appendChild(BX("rename_column_"+this.table_id));var s=n.view_cols.value;i.col_name.focus();i.col_name_def.value=this.oColsNames[s];i.col_name.value=this.customNames[s]?this.customNames[s]:this.oColsNames[s]};this.SaveSettings=function(t,n){var s=document["settings_"+this.table_id];var a="";var r=s.view_cols.length;for(var o=0;o<r;o++)a+=(a!=""?",":"")+s.view_cols[o].value;var l={GRID_ID:this.grid_id,view_id:t,action:i.getUserOptions().getAction("GRID_SAVE_SETTINGS"),sessid:this.vars.sessid,name:s.view_name.value,columns:a,sort_by:s.view_sort_by.value,sort_order:s.view_sort_order.value,page_size:s.view_page_size.value,saved_filter:s.view_filters.value,custom_names:this.customNames,columns_sizes:!s.reset_columns_sizes.checked?this.columnsSizes:{}};if(s.set_default_settings){l.set_default_settings=s.set_default_settings.checked?"Y":"N";l.delete_users_settings=s.delete_users_settings.checked?"Y":"N"}var d=null;if(n===true){d=function(){if(l.saved_filter&&e.oOptions.filters[l.saved_filter]){e.ApplyFilter(l.saved_filter)}else{i.reloadTable()}}}BX.ajax.post("/bitrix/components"+e.vars.component_path+"/settings.ajax.php",l,d);return l};this.ReloadViews=function(){if(e.bViewsChanged)e.Reload()};this.ShowViews=function(){this.bViewsChanged=false;var t=false;if(!window["viewsDialog"+this.table_id]){var i=new BX.CWindowButton({title:this.vars.mess.viewsApply,hint:this.vars.mess.viewsApplyTitle,action:function(){var t=document["views_"+e.table_id];if(t.views_list.selectedIndex!=-1)e.SetView(t.views_list.value);window["bxGrid_"+e.table_id].bViewsChanged=false;this.parentWindow.Close()}});window["viewsDialog"+this.table_id]=new BX.CDialog({content:'<form name="views_'+this.table_id+'"></form>',title:this.vars.mess.viewsTitle,buttons:[i,BX.CDialog.prototype.btnClose],width:this.vars.viewsWndSize.width,height:this.vars.viewsWndSize.height,resize_id:"InterfaceGridViewsWnd"});BX.addCustomEvent(window["viewsDialog"+this.table_id],"onWindowUnRegister",this.ReloadViews);t=true}window["viewsDialog"+this.table_id].Show();var n=document["views_"+this.table_id];if(t)n.appendChild(BX("views_list_"+this.table_id))};this.DragStart=function(){e.onDragStart(this);var t=BX.Main.gridManager.getById(e.grid_id).instance;var i=t.getContainer();var n=t.getTable();var s=t.getRows().getHeadChild()[0].getCells();var a=BX.pos(this);var r=BX.pos(i);var o=a.left-r.left;var l=BX.findChildByClassName(this,"main-grid-cell-head-container",false);this.__cursor=BX.create("div",{props:{className:t.settings.get("classCursor")}});i.appendChild(this.__cursor);l.style.width=this.clientWidth+"px";l.style.height=this.clientHeight+"px";this.__dragNode=document.createElement("DIV");this.__dragNode.className="main-grid-cell-head-drag";this.__dragNode.appendChild(l);BX.style(this.__dragNode,"left",o+"px");n.parentNode.insertBefore(this.__dragNode,n);this.style.height=a.height+"px";this.innerHTML='<span class="main-grid-cell-head-container" style="z-index: 25; "></span>';BX.addClass(this,"main-grid-cell-head-drag-dest");this.__dragDest=this.cellIndex;this.__dragX=o-jsDD.start_x;this.__dragCells=[];for(var d=0;d<s.length;d++){if(s[d].__fixed)continue;var h=BX.pos(s[d]);if(!h.width)continue;var c=BX.findChildByClassName(s[d],"main-grid-cell-head-container",false);BX.addClass(s[d],"main-grid-cell-head-ondrag");this.__cursor.style.left=h.left-r.left+"px";if(d==this.cellIndex){c.style.height=h.height-2+"px";this.__dragCells.ref=this.__dragCells.length}this.__dragCells.push({index:d,node:c,offset:h.left-r.left,width:h.width,move:0})}if(this.__dragCells.length>1&&this.__dragCells.ref==this.__dragCells.length-1){var u=this.__dragCells[this.__dragCells.length-2].index;BX.addClass(s[u],"main-grid-cell-last")}};this.Drag=function(t){var i=this;var n=BX.Main.gridManager.getById(e.grid_id).instance;var s=n.getContainer();var a=t+this.__dragX;var r=BX.pos(s);var o,l,d;this.__dragNode.style.left=a+"px";for(var h=this.__dragCells.length-1;h>=0;h--){if(t-r.left>this.__dragCells[h].offset){this.__dest=this.__dragCells[h].index;break}}o=this.__dragCells.filter(function(t){return t.index==i.__dragDest})[0];l=this.__dragCells.filter(function(t){return t.index==i.__dest})[0];d=l.offset;if(this.__dest>this.__dragDest){d=l.offset+l.width}o.node.style.left=d+"px";this.__cursor.style.left=d+"px"};this.DragStop=function(){e.onDragStop(this);var t=this;var i=BX.Main.gridManager.getById(e.grid_id).instance;var n=i.getRows().getList();var s,a,r,o,l;var d=BX.findChildByClassName(this.__dragNode,i.settings.get("classCellHeadContainer"),false);this.innerHTML="";this.appendChild(d);this.style.height="";BX.removeClass(this,"main-grid-cell-head-drag-dest");BX.remove(this.__cursor);BX.remove(this.__dragNode);n.map(function(e){s=e.getCells();a=s[t.__dragDest];r=s[t.__dest];if(e.isHeadChild()||e.isBodyChild()||e.isFootChild()){if(t.__dest<t.__dragDest){e.getNode().insertBefore(a,r)}if(t.__dest>t.__dragDest){if(BX.type.isDomNode(r.nextElementSibling)){e.getNode().insertBefore(a,r.nextElementSibling)}else{e.getNode().appendChild(a)}}for(var n=0;n<s.length;n++){var o=BX.findChildByClassName(s[n],i.settings.get("classCellHeadContainer"),false);if(o&&o.style){o.style.width="";o.style.left=""}BX.removeClass(s[n],i.settings.get("classCellHeadOndrag"))}}});if(this.__dest!==this.__dragDest){s=i.getRows().getHeadChild()[0].getCells();l=e.oVisibleCols;e.oVisibleCols={};[].forEach.call(s,function(t){o=BX.data(t,"name");if(o){e.oVisibleCols[o]=l[o]}});e.bColsChanged=true;e.SaveColumns()}};this.resizeColumnStart=function(){var t=BX.findParent(this,{className:"main-grid-cell-head"});e.onDragStart(t);this.__resizeCell=t.cellIndex};this.resizeColumn=function(t){var n=BX(e.table_id);var s=i.getPinHeader().getFixedTable();var a=n.rows[0].cells[this.__resizeCell];var r;var o=BX.pos(n);var l=BX.pos(a);t-=l.left;if(t<e.resizeMeta.minColumn)t=e.resizeMeta.minColumn;a.style.width=t+"px";if(BX.type.isDomNode(s)&&BX.type.isDomNode(s.rows[0])){r=s.rows[0].cells[this.__resizeCell];r.style.width=t+"px"}e.toogleFader()};this.resizeColumnStop=function(){var t=BX(e.table_id);var i=t.rows[0].cells;e.reinitResizeMeta();e.toogleFader();e.onDragStop(i[this.__resizeCell])};this.onDragStart=function(t){if(t.getAttribute("onclick")){t.setAttribute("data-onclick",t.getAttribute("onclick"));t.removeAttribute("onclick")}};this.onDragStop=function(t){if(t.getAttribute("data-onclick")){setTimeout(function(){t.setAttribute("onclick",t.getAttribute("data-onclick"));t.removeAttribute("data-onclick")},10)}};this.InitFilter=function(){var t=BX("flt_header_"+this.table_id);if(t)jsUtils.addEvent(t,"contextmenu",this.OnRowContext)};this.SwitchFilterRow=function(t,e){if(e){var i=this.menu.GetMenuByItemId(e.id);i.SetItemIcon(e,this.oFilterRows[t]?"":"checked")}else{var n=this.filterMenu[0].MENU;for(var s=0;s<n.length;s++){if(n[s].ID=="flt_"+this.table_id+"_"+t){n[s].ICONCLASS=this.oFilterRows[t]?"":"checked";break}}}var a=BX("flt_row_"+this.table_id+"_"+t);a.style.display=this.oFilterRows[t]?"none":"";this.oFilterRows[t]=this.oFilterRows[t]?false:true;var r=BX("a_minmax_"+this.table_id);if(r&&r.className.indexOf("bx-filter-max")!=-1)this.SwitchFilter(r);this.SaveFilterRows()};this.SwitchFilterRows=function(t){this.menu.PopupHide();var e=0;for(var i in this.oFilterRows){e++;if(e==1&&t==false)continue;this.oFilterRows[i]=t;var n=BX("flt_row_"+this.table_id+"_"+i);n.style.display=t?"":"none"}var s=this.filterMenu[0].MENU;for(e=0;e<s.length;e++){if(e==0&&t==false)continue;if(s[e].SEPARATOR==true)break;s[e].ICONCLASS=t?"checked":""}var a=BX("a_minmax_"+this.table_id);if(a&&a.className.indexOf("bx-filter-max")!=-1)this.SwitchFilter(a);this.SaveFilterRows()};this.SaveFilterRows=function(){var t="";for(var e in this.oFilterRows)if(this.oFilterRows[e])t+=(t!=""?",":"")+e;BX.ajax.get("/bitrix/components"+this.vars.component_path+"/settings.ajax.php?GRID_ID="+this.table_id+"&action=filterrows&rows="+t+"&sessid="+this.vars.sessid)};this.SwitchFilter=function(t){var e=t.className.indexOf("bx-filter-min")!=-1;t.className=e?"bx-filter-btn bx-filter-max":"bx-filter-btn bx-filter-min";t.title=e?this.vars.mess.filterShow:this.vars.mess.filterHide;var i=BX("flt_content_"+this.table_id);i.style.display=e?"none":"";BX.ajax.get("/bitrix/components"+this.vars.component_path+"/settings.ajax.php?GRID_ID="+this.table_id+"&action=filterswitch&show="+(e?"N":"Y")+"&sessid="+this.vars.sessid)};this.ClearFilter=function(t){for(var e=0,i=t.elements.length;e<i;e++){var n=t.elements[e];switch(n.type.toLowerCase()){case"text":case"textarea":n.value="";break;case"select-one":n.selectedIndex=0;break;case"select-multiple":for(var s=0,a=n.options.length;s<a;s++)n.options[s].selected=false;break;case"checkbox":n.checked=false;break;default:break}if(n.onchange)n.onchange()}BX.onCustomEvent(t,"onGridClearFilter",[]);t.clear_filter.value="Y";BX.submit(t)};this.ShowFilters=function(){var t=false;if(!window["filtersDialog"+this.table_id]){var i=new BX.CWindowButton({title:this.vars.mess.filtersApply,hint:this.vars.mess.filtersApplyTitle,action:function(){var t=document["filters_"+e.table_id];if(t.filters_list.value)e.ApplyFilter(t.filters_list.value);this.parentWindow.Close()}});window["filtersDialog"+this.table_id]=new BX.CDialog({content:'<form name="filters_'+this.table_id+'"></form>',title:this.vars.mess.filtersTitle,buttons:[i,BX.CDialog.prototype.btnClose],width:this.vars.filtersWndSize.width,height:this.vars.filtersWndSize.height,resize_id:"InterfaceGridFiltersWnd"});t=true}window["filtersDialog"+this.table_id].Show();var n=document["filters_"+this.table_id];if(t)n.appendChild(BX("filters_list_"+this.table_id))};this.AddFilter=function(t){if(!t)t={};var i="filter_"+Math.round(Math.random()*1e6);var n={name:this.vars.mess.filtersNew,fields:t};this.ShowFilterSettings(n,function(){var t=e.SaveFilter(i);e.oOptions.filters[i]={name:t.name,fields:t.fields};var n=document["filters_"+e.table_id];n.filters_list.options[n.filters_list.length]=new Option(t.name!=""?t.name:e.vars.mess.viewsNoName,i,true,true);if(e.filterMenu.length==4)e.filterMenu=BX.util.insertIntoArray(e.filterMenu,1,{SEPARATOR:true});var s={ID:"mnu_"+e.table_id+"_"+i,TEXT:BX.util.htmlspecialchars(t.name),TITLE:e.vars.mess.ApplyTitle,ONCLICK:"bxGrid_"+e.table_id+".ApplyFilter('"+i+"')"};e.filterMenu=BX.util.insertIntoArray(e.filterMenu,2,s)})};this.AddFilterAs=function(){var t=document.forms["filter_"+this.table_id];var e=this.GetFilterFields(t);this.ShowFilters();this.AddFilter(e)};this.EditFilter=function(t){this.ShowFilterSettings(this.oOptions.filters[t],function(){var i=e.SaveFilter(t);e.oOptions.filters[t]={name:i.name,fields:i.fields};var n=document["filters_"+e.table_id];n.filters_list.options[n.filters_list.selectedIndex].text=i.name!=""?i.name:e.vars.mess.viewsNoName;for(var s=0,a=e.filterMenu.length;s<a;s++){if(e.filterMenu[s].ID&&e.filterMenu[s].ID=="mnu_"+e.table_id+"_"+t){e.filterMenu[s].TEXT=BX.util.htmlspecialchars(i.name);break}}})};this.DeleteFilter=function(t){if(!confirm(this.vars.mess.filtersDelete))return;var i=document["filters_"+this.table_id];var n=i.filters_list.selectedIndex;i.filters_list.remove(n);i.filters_list.selectedIndex=n<i.filters_list.length?n:i.filters_list.length-1;for(var s=0,a=this.filterMenu.length;s<a;s++){if(e.filterMenu[s].ID&&e.filterMenu[s].ID=="mnu_"+e.table_id+"_"+t){this.filterMenu=BX.util.deleteFromArray(this.filterMenu,s);if(this.filterMenu.length==5)this.filterMenu=BX.util.deleteFromArray(this.filterMenu,1);

break}}delete this.oOptions.filters[t];BX.ajax.get("/bitrix/components"+this.vars.component_path+"/settings.ajax.php?GRID_ID="+this.table_id+"&action=delfilter&filter_id="+t+"&sessid="+e.vars.sessid)};this.ShowFilterSettings=function(t,e){var i=false;if(!window["filterSettingsDialog"+this.table_id]){window["filterSettingsDialog"+this.table_id]=new BX.CDialog({content:'<form name="flt_settings_'+this.table_id+'"></form>',title:this.vars.mess.filterSettingsTitle,width:this.vars.filterSettingWndSize.width,height:this.vars.filterSettingWndSize.height,resize_id:"InterfaceGridFilterSettingWnd"});i=true}window["filterSettingsDialog"+this.table_id].ClearButtons();window["filterSettingsDialog"+this.table_id].SetButtons([{title:this.vars.mess.settingsSave,action:function(){e();this.parentWindow.Close()}},BX.CDialog.prototype.btnCancel]);window["filterSettingsDialog"+this.table_id].Show();var n=document["flt_settings_"+this.table_id];if(i)n.appendChild(BX("filter_settings_"+this.table_id));n.filter_name.focus();n.filter_name.value=t.name;this.SetFilterFields(n,t.fields)};this.SetFilterFields=function(t,e){for(var i=0,n=t.elements.length;i<n;i++){var s=t.elements[i];if(s.name=="filter_name")continue;var a=e[s.name]||"";switch(s.type.toLowerCase()){case"select-one":case"text":case"textarea":s.value=a;break;case"radio":case"checkbox":s.checked=s.value==a;break;case"select-multiple":var r=s.name.substr(0,s.name.length-2);var o=false;for(var l=0,d=s.options.length;l<d;l++){var h=e[r]?e[r]["sel"+s.options[l].value]:null;s.options[l].selected=s.options[l].value==h;if(s.options[l].value==h)o=true}if(!o&&s.options.length>0&&s.options[0].value=="")s.options[0].selected=true;break;default:break}if(s.onchange)s.onchange()}};this.GetFilterFields=function(t){var e={};for(var i=0,n=t.elements.length;i<n;i++){var s=t.elements[i];if(s.name=="filter_name")continue;switch(s.type.toLowerCase()){case"select-one":case"text":case"textarea":e[s.name]=s.value;break;case"radio":case"checkbox":if(s.checked)e[s.name]=s.value;break;case"select-multiple":var a=s.name.substr(0,s.name.length-2);e[a]={};for(var r=0,o=s.options.length;r<o;r++)if(s.options[r].selected)e[a]["sel"+s.options[r].value]=s.options[r].value;break;default:break}}return e};this.SaveFilter=function(t){var i=document["flt_settings_"+this.table_id];var n={GRID_ID:this.table_id,filter_id:t,action:"savefilter",sessid:this.vars.sessid,name:i.filter_name.value,fields:this.GetFilterFields(i)};BX.ajax.post("/bitrix/components"+e.vars.component_path+"/settings.ajax.php",n);return n};this.ApplyFilter=function(t){var e=document.forms["filter_"+this.table_id];this.SetFilterFields(e,this.oOptions.filters[t].fields);BX.submit(e)};this.OnDateChange=function(t){var e=false,i=false,n=false,s=false,a=false;if(t.value=="interval")a=e=i=n=true;else if(t.value=="before")i=true;else if(t.value=="after"||t.value=="exact")e=true;else if(t.value=="days")s=true;BX.findNextSibling(t,{tag:"span","class":"bx-filter-from"}).style.display=e?"":"none";BX.findNextSibling(t,{tag:"span","class":"bx-filter-to"}).style.display=i?"":"none";BX.findNextSibling(t,{tag:"span","class":"bx-filter-hellip"}).style.display=n?"":"none";BX.findNextSibling(t,{tag:"span","class":"bx-filter-days"}).style.display=s?"":"none";var r=BX.findNextSibling(t,{tag:"span","class":"bx-filter-br"});if(r)r.style.display=a?"":"none"};this.loadColumn=function(t){var i=BX(this.table_id);var n=this.GetColumnId(t);var s=i.rows[0].cells[n];s.removeAttribute("data-empty");if(s.getAttribute("data-resize"))jsDD.Disable();var a=[];var r=function(r){a.push(r);for(var o in r.edit){if(typeof r.edit[o][t]!="undefined"){if(typeof e.oEditData[o]=="undefined")e.oEditData[o]={};e.oEditData[o][t]=r.edit[o][t]}}if(a.length<e.vars.current_url.length)return;for(var o in a){for(var l in a[o].data){var d=BX("datarow_"+e.table_id+"_"+l).cells[n];BX.findChildByClassName(d,"main-grid-cell-content").innerHTML=a[o].data[l][t]}}if(s.getAttribute("data-resize")){s.removeAttribute("data-resize");var h=i.offsetWidth;var c=s.offsetWidth;e.animation.stop(s);if(s.offsetWidth>0){e.reinitColumnSize(t);var u=s.offsetWidth;s.style.width=c+"px";e.toogleColumnCells(n,true,true);var f={width:{from:c,to:u,unit:"px"}};e.animation(s,f,100,function(){e.toogleColumnCells(n,true,false);e.reinitResizeMeta();e.toogleFader()})}jsDD.Enable()}e.toggleCheckboxes()};for(var o in this.vars.current_url){BX.ajax({url:this.vars.current_url[o],method:"GET",dataType:"json",headers:[{name:"X-Ajax-Grid-UID",value:this.vars.ajax.GRID_AJAX_UID},{name:"X-Ajax-Grid-Req",value:JSON.stringify({action:"showcolumn",column:t})}],onsuccess:r,onfailure:function(){s.setAttribute("data-empty",1);jsDD.Enable()}})}};this.getData=function(t,e){BX.ajax({url:t+(t.indexOf("?")!==-1?"&":"?")+"bxajaxid="+this.vars.ajax.AJAX_ID,method:"GET",dataType:"html",headers:[{name:"X-Ajax-Grid-UID",value:this.vars.ajax.GRID_AJAX_UID},{name:"X-Ajax-Grid-Req",value:JSON.stringify({action:"showpage",columns:this.oVisibleCols})}],processData:true,scriptsRunFirst:true,onsuccess:function(t){e(t)}})}}(function(){"use strict";BX.namespace("BX.Main");var GridSettings,GridRows,GridRow,GridElement,GridObserver,GridPagination,GridRowsSortable,GridColsSortable,GridUpdater,GridUtils,GridUserOptions,GridBaseClass,GridData,GridFader,GridPageSize,GridActionPanel,GridInlineEditor,GridPinHeader,GridPinPanel;GridSettings=function(){var t;this.settings={};this.defaultSettings={classContainer:"main-grid",classWrapper:"main-grid-wrapper",classTable:"main-grid-table",classScrollContainer:"main-grid-container",classFadeContainer:"main-grid-fade",classFadeContainerRight:"main-grid-fade-right",classFadeContainerLeft:"main-grid-fade-left",classNavPanel:"main-grid-nav-panel",classActionPanel:"main-grid-action-panel",classCursor:"main-grid-cursor",classMoreButton:"main-grid-more-btn",classRow:"main-grid-row",classHeadRow:"main-grid-row-head",classBodyRow:"main-grid-row-body",classFootRow:"main-grid-row-foot",classDataRows:"main-grid-row-data",classCellHeadContainer:"main-grid-cell-head-container",classCellHeadOndrag:"main-grid-cell-head-ondrag",classEmptyRows:"main-grid-row-empty",classCheckAllCheckboxes:"main-grid-check-all",classCheckedRow:"main-grid-row-checked",classRowCheckbox:"main-grid-row-checkbox",classPagination:"main-grid-panel-cell-pagination",classActionCol:"main-grid-cell-action",classCounterDisplayed:"main-grid-counter-displayed",classCounterSelected:"main-grid-counter-selected",classCounterTotal:"main-grid-panel-total",classTableFade:"main-grid-table-fade",classDragActive:"main-grid-on-row-drag",classResizeButton:"main-grid-resize-button",classOnDrag:"main-grid-ondrag",classHeaderSortable:"main-grid-col-sortable",classCellStatic:"main-grid-cell-static",classHeadCell:"main-grid-cell-head",classPageSize:"main-grid-panel-select-pagesize",classGroupEditButton:"main-grid-control-panel-action-edit",classGroupDeleteButton:"main-grid-control-panel-action-remove",classGroupActionsDisabled:"main-grid-control-panel-action-icon-disable",classPanelButton:"main-grid-buttons",classPanelApplyButton:"main-grid-control-panel-apply-button",classPanelCheckbox:"main-grid-panel-checkbox",classEditor:"main-grid-editor",classEditorContainer:"main-grid-editor-container",classEditorText:"main-grid-editor-text",classEditorDate:"main-grid-editor-date",classEditorNumber:"main-grid-editor-number",classEditorRange:"main-grid-editor-range",classEditorCheckbox:"main-grid-editor-checkbox",classEditorTextarea:"main-grid-editor-textarea",classCellContainer:"main-grid-cell-content",classEditorOutput:"main-grid-editor-output",classLoad:"load",classRowActionButton:"main-grid-row-action-button",classDropdown:"main-dropdown",classPanelControl:"main-grid-panel-control",classPanelControlContainer:"main-grid-panel-control-container",classDisable:"main-grid-disable",dataActionsKey:"actions",updateActionMore:"more",classShow:"show",updateActionPagination:"pagination",updateActionSort:"sort",ajaxIdDataProp:"ajaxid",pageSizeId:"grid_page_size",sortableRows:true,sortableColumns:true,animationDuration:300};this.prepare()};GridSettings.prototype={prepare:function(){this.settings=this.defaultSettings},getDefault:function(){return this.defaultSettings},get:function(t){var e;try{e=this.getDefault()[t]}catch(i){e=null}return e},getList:function(){return this.getDefault()}};GridObserver={handlers:[],add:function(t,e,i,n){if(!this.get({node:t,event:e,handler:i}).length){this.handlers.push({node:t,event:e,handler:i,context:n});BX.bind(t,e,n?BX.delegate(i,n):i)}},get:function(t){var e=this.handlers;var i;if(BX.type.isPlainObject(t)&&(BX.type.isArray(this.handlers)&&this.handlers.length)){i=Object.keys(t);e=this.handlers.filter(function(e){return i.filter(function(i){return e[i]===t[i]}).length===i.length})}return e}};GridInlineEditor=function(t,e){this.parent=null;this.types=null;this.init(t,e)};GridInlineEditor.prototype={init:function(t,e){this.parent=t;try{this.types=JSON.parse(e)}catch(i){this.types=null}},createContainer:function(){return BX.create("div",{props:{className:this.parent.settings.get("classEditorContainer")}})},createTextarea:function(t,e){var i=BX.create("textarea",{props:{className:[this.parent.settings.get("classEditor"),this.parent.settings.get("classEditorTextarea")].join(" ")},attrs:{name:t.NAME,style:"height:"+e+"px"},html:t.VALUE});return i},createInput:function(t){var e=this.parent.settings.get("classEditorText");var i={value:t.VALUE!==undefined&&t.VALUE!==null?t.VALUE:"",name:t.NAME!==undefined&&t.NAME!==null?t.NAME:""};if(t.TYPE===this.types.CHECKBOX){e=[e,this.parent.settings.get("classEditorCheckbox")].join(" ");i.type="checkbox"}if(t.TYPE===this.types.DATE){e=[e,this.parent.settings.get("classEditorDate")].join(" ")}if(t.TYPE===this.types.NUMBER){e=[e,this.parent.settings.get("classEditorNumber")].join(" ");i.type="number"}if(t.TYPE===this.types.RANGE){e=[e,this.parent.settings.get("classEditorRange")].join(" ");i.type="range";if(BX.type.isPlainObject(t.DATA)){i.min=t.DATA.MIN||"0";i.max=t.DATA.MAX||99999;i.step=t.DATA.STEP||""}}e=[this.parent.settings.get("classEditor"),e].join(" ");return BX.create("input",{props:{className:e,id:t.NAME+"_control"},attrs:i})},createOutput:function(t){return BX.create("output",{props:{className:this.parent.settings.get("classEditorOutput")||""},attrs:{"for":t.NAME+"_control"},text:t.VALUE||""})},getDropdownValueItemByValue:function(t,e){var i=t.filter(function(t){return t.VALUE===e});return i.length>0?i[0]:null},createDropdown:function(t){var e=this.getDropdownValueItemByValue(t.DATA.ITEMS,t.VALUE);return BX.create("div",{props:{className:[this.parent.settings.get("classEditor"),"main-dropdown main-grid-editor-dropdown"].join(" "),id:t.NAME+"_control"},attrs:{name:t.NAME,"data-items":JSON.stringify(t.DATA.ITEMS),"data-value":e.VALUE},html:e.NAME})},validateEditObject:function(t){return BX.type.isPlainObject(t)&&"TYPE"in t&&"NAME"in t&&"VALUE"in t},initCalendar:function(t){BX.calendar({node:t.target,field:t.target})},bindOnRangeChange:function(t,e){function i(t,e){BX.html(e,t.value);var i=parseFloat(t.value);var n=parseFloat(t.getAttribute("max"));var s=parseFloat(t.getAttribute("min"));var a=16;var r=n-s;var o=(i-s)/r*100;var l=Math.round(a*o/100)-a/2;e.style.left=o+"%";e.style.marginLeft=-l+"px"}setTimeout(function(){i(t,e)},0);BX.bind(t,"input",function(){i(t,e)})},getEditor:function(t,e){var i,n;var s=this.createContainer();if(this.validateEditObject(t)){switch(t.TYPE){case this.types.TEXT:{i=this.createInput(t);break}case this.types.DATE:{i=this.createInput(t);BX.bind(i,"click",this.initCalendar);break}case this.types.NUMBER:{i=this.createInput(t);break}case this.types.RANGE:{i=this.createInput(t);n=this.createOutput(t);this.bindOnRangeChange(i,n);break}case this.types.CHECKBOX:{i=this.createInput(t);break}case this.types.TEXTAREA:{i=this.createTextarea(t,e);break}case this.types.DROPDOWN:{i=this.createDropdown(t);break}default:{break}}}if(BX.type.isDomNode(n)){s.appendChild(n)}if(BX.type.isDomNode(i)){s.appendChild(i)}return s}};GridRow=function(t,e){this.node=null;this.checkbox=null;this.sort=null;this.actions=null;this.settings=null;this.index=null;this.actionsButton=null;this.parent=null;this.init(t,e)};GridRow.prototype={init:function(t,e){if(BX.type.isDomNode(e)){this.node=e;this.parent=t;this.settings=new GridSettings;this.actions=this.getActions();this.checkbox=this.getCheckbox();this.index=this.getIndex()}},editGetValues:function(){var t=this;var e=this.getCells();var i={};var n;[].forEach.call(e,function(e){n=t.getCellEditorValue(e);if(n){i[n.NAME]=n.VALUE!==undefined?n.VALUE:""}});return i},getCellEditorValue:function(t){var e=BX.findChild(t,{"class":this.parent.settings.get("classEditor")},true,false);var i=null;if(BX.type.isDomNode(e)){if(e.value){i={NAME:e.getAttribute("name"),VALUE:e.value}}else{i={NAME:e.getAttribute("name"),VALUE:BX.data(e,"data-value")}}}return i},isEdit:function(){return BX.hasClass(this.getNode(),"main-grid-row-edit")},getContentContainer:function(t){return BX.findChild(t,{className:this.parent.settings.get("classCellContainer")})},getContent:function(t){var e=this.getContentContainer(t);var i;if(BX.type.isDomNode(e)){i=BX.html(e)}return i},getEditorContainer:function(t){return BX.findChild(t,{className:this.parent.settings.get("classEditorContainer")})},editCancel:function(){var t=this.getCells();var e=this;var i;[].forEach.call(t,function(t){i=e.getEditorContainer(t);if(BX.type.isDomNode(i)){BX.remove(e.getEditorContainer(t));BX.show(e.getContentContainer(t))}});BX.removeClass(this.getNode(),"main-grid-row-edit")},edit:function(){var t=this.getCells();var e=this;var i,n,s,a;[].forEach.call(t,function(t){try{i=JSON.parse(BX.data(t,"edit"))}catch(r){i=null}if(e.parent.getEditor().validateEditObject(i)){a=e.getContentContainer(t);s=BX.height(a);n=e.parent.getEditor().getEditor(i,s);if(!e.getEditorContainer(t)&&BX.type.isDomNode(n)){t.appendChild(n);BX.hide(a)}}});BX.addClass(this.getNode(),"main-grid-row-edit")},setDraggable:function(t){this.getNode().draggable=t?"true":"false"},getNode:function(){return this.node},getIndex:function(){return this.getNode().rowIndex},getId:function(){return parseFloat(BX.data(this.getNode(),"id"))},getObserver:function(){return GridObserver},getCheckbox:function(){return this.checkbox||BX.findChild(this.getNode(),{"class":this.settings.get("classRowCheckbox")},true,false)},getActionsMenu:function(){var t=this.getActionsButton().getBoundingClientRect();this.actionsMenu=this.actionsMenu||BX.PopupMenu.create("main-grid-actions-menu-"+this.getIndex(),this.getActionsButton(),this.getMenuItems(),{autoHide:true,offsetTop:-(t.height/2+26),offsetLeft:30,angle:{position:"left",offset:t.height/2-8},events:{onPopupClose:BX.delegate(this._onCloseMenu,this)}});return this.actionsMenu},_onCloseMenu:function(){},actionsMenuIsShown:function(){return this.getActionsMenu().popupWindow.isShown()},showActionsMenu:function(){BX.PopupMenu.destroy("main-grid-actions-menu-"+this.getIndex());this.actionsMenu=null;this.getActionsMenu().popupWindow.adjustPosition(BX.pos(this.getActionsButton()));this.getActionsMenu().popupWindow.show()},closeActionsMenu:function(){this.getActionsMenu().popupWindow.close()},prepareMenuItems:function(t,e){var i=this;var n;this.parentKey=this.parentKey||0;n=t.some(function(t){return BX.type.isNotEmptyString(t.className)&&t.className!=="menu"});return t.map(function(t,e){if(BX.type.isArray(t.menu)){t.menu=i.prepareMenuItems(t.menu,e);t.menu=JSON.stringify(t.menu);t.onclick="BX.Main.submenu.init(this, 'main_grid_submenu_"+i.parentKey+"_"+e+"', "+i.parentKey+", "+t.menu+")";t.className=[t.className||"","menu"].join(" ");i.parentKey+=1}if(n){t.className=t.className?[t.className,"icon"].join(" "):"none"}else{t.className=[t.className||"","menu-popup-no-icon"].join(" ")}return t})},getMenuItems:function(){var t=this.getActions()||[];return this.prepareMenuItems(t)},getActions:function(){try{this.actions=this.actions||JSON.parse(BX.data(this.getActionsButton(),this.settings.get("dataActionsKey")))}catch(t){this.actions=null}return this.actions},getActionsButton:function(){this.actionsButton=this.actionsButton||BX.findChild(this.getNode(),{"class":this.settings.get("classRowActionButton")},true,false);return this.actionsButton},getParentNode:function(){var t;try{t=this.getNode().parentNode}catch(e){t=null}return t},getParentNodeName:function(){var t;try{t=this.getParentNode().nodeName}catch(e){t=null}return t},select:function(){if(!this.isEdit()){BX.addClass(this.getNode(),this.settings.get("classCheckedRow"));if(this.getCheckbox()){this.getCheckbox().checked=true}}},unselect:function(){if(!this.isEdit()){BX.removeClass(this.getNode(),this.settings.get("classCheckedRow"));if(this.getCheckbox()){this.getCheckbox().checked=false}}},getCells:function(){return this.getNode().cells},isSelected:function(){return this.getCheckbox()&&this.getCheckbox().checked||BX.hasClass(this.getNode(),this.settings.get("classCheckedRow"))},isHeadChild:function(){return this.getParentNodeName()==="THEAD"&&BX.hasClass(this.getNode(),this.settings.get("classHeadRow"))},isBodyChild:function(){return this.getParentNodeName()==="TBODY"&&BX.hasClass(this.getNode(),this.settings.get("classBodyRow"))},isFootChild:function(){return this.getParentNodeName()==="TFOOT"&&BX.hasClass(this.getNode(),this.settings.get("classFootRow"))}};GridRows=function(t){var e;this.parent=null;this.rows=null;this.headChild=null;this.bodyChild=null;this.footChild=null;this.init(t)};GridRows.prototype={init:function(t){this.parent=t},getFootLastChild:function(){return this.getLast(this.getFootChild())},getFootFirstChild:function(){return this.getFirst(this.getFootChild())},getBodyLastChild:function(){return this.getLast(this.getBodyChild())},getBodyFirstChild:function(){return this.getFirst(this.getBodyChild())},getHeadLastChild:function(){return this.getLast(this.getHeadChild())},getHeadFirstChild:function(){return this.getFirst(this.getHeadChild())},getEditSelectedValues:function(){var t=this.getSelected();var e={};t.forEach(function(t){e[t.getId()]=t.editGetValues()});return e},getSelectedIds:function(){return this.getSelected().map(function(t){return t.getId()})},editSelected:function(){this.getSelected().forEach(function(t){t.edit()});BX.onCustomEvent(window,"Grid::thereEditedRows",[])},editSelectedCancel:function(){this.getSelected().forEach(function(t){t.editCancel()});BX.onCustomEvent(window,"Grid::noEditedRows",[])},isSelected:function(){return this.getBodyChild().some(function(t){return t.isSelected()})},isAllSelected:function(){return!this.getBodyChild().some(function(t){return!t.isSelected()})},getParent:function(){return this.parent},getCountSelected:function(){var t;try{t=this.getSelected().length}catch(e){t=0}return t},getCountDisplayed:function(){var t;try{t=this.getBodyChild().length}catch(e){t=0}return t},addRows:function(t){var e=BX.findChild(this.getParent().getTable(),{tag:"TBODY"},true,false);t.forEach(function(t){e.appendChild(t)})},getRows:function(){var t;var e=this;if(!this.rows){t=BX.findChild(this.getParent().getTable(),{tag:"tr"},true,true);this.rows=[].map.call(t,function(t){return new GridRow(e.parent,t)})}return this.rows},getSelected:function(){return this.getBodyChild().filter(function(t){return t.isSelected()})},normalizeNode:function(t){return BX.findParent(t,{"class":this.getParent().settings.get("classBodyRow")},true,false)},getById:function(t){var e=this.getBodyChild();var i=e.filter(function(e){return e.getId()===parseFloat(t)});return i.length===1?i[0]:null},get:function(t){var e=null;var i;if(BX.type.isDomNode(t)){t=this.normalizeNode(t);i=this.getRows().filter(function(e){return t===e.getNode()});if(i.length){e=i[0]}}return e},getLast:function(t){var e;try{e=t[t.length-1]}catch(i){e=null}return e},getFirst:function(t){var e;try{e=t[0]}catch(i){e=null}return e},getHeadChild:function(){this.headChild=this.headChild||this.getRows().filter(function(t){return t.isHeadChild()});return this.headChild},getBodyChild:function(){this.bodyChild=this.bodyChild||this.getRows().filter(function(t){return t.isBodyChild()});return this.bodyChild},getFootChild:function(){this.footChild=this.footChild||this.getRows().filter(function(t){return t.isFootChild()});return this.footChild},selectAll:function(){this.getRows().map(function(t){t.select()})},unselectAll:function(){this.getRows().map(function(t){t.unselect()})},getByIndex:function(t){var e=this.getBodyChild().filter(function(e){return e.getNode().rowIndex===t});return e.length?e[0]:null},getSourceRows:function(){return BX.findChild(this.getParent().getTable(),{tag:"tr"},true,true)},getSourceBodyChild:function(){return this.getSourceRows().filter(function(t){return GridUtils.closestParent(t).nodeName==="TBODY"})},getSourceHeadChild:function(){return this.getSourceRows().filter(function(t){return GridUtils.closestParent(t).nodeName==="THEAD"})},getSourceFootChild:function(){return this.getSourceRows().filter(function(t){return GridUtils.closestParent(t).nodeName==="TFOOT"})}};GridElement=function(t,e){this.node=null;this.href=null;this.parent=null;this.init(t,e)};GridElement.prototype={init:function(t,e){this.node=t;this.parent=e;this.resetOnclickAttr()},getParent:function(){return this.parent},load:function(){BX.addClass(this.getNode(),this.getParent().settings.get("classLoad"))},unload:function(){BX.removeClass(this.getNode(),this.getParent().settings.get("classLoad"))},isLoad:function(){return BX.hasClass(this.getNode(),this.getParent().settings.get("classLoad"))},resetOnclickAttr:function(){if(BX.type.isDomNode(this.getNode())){this.getNode().onclick=null}},getObserver:function(){return GridObserver},getNode:function(){return this.node},getLink:function(){var t;try{t=this.getNode().href}catch(e){t=null}return t}};GridPagination=function(t){this.parent=null;this.container=null;this.links=null;this.init(t)};GridPagination.prototype={init:function(t){this.parent=t},getParent:function(){return this.parent},getContainer:function(){this.container=this.container||BX.findChild(this.getParent().getContainer(),{"class":this.getParent().settings.get("classPagination")},true,false);return this.container},getLinks:function(){var t=this;var e=BX.findChild(this.getContainer(),{tag:"a"},true,true);this.links=[];if(e){this.links=e.map(function(e){return new GridElement(e,t.getParent())})}return this.links},getLink:function(t){var e=null;var i;if(BX.type.isDomNode(t)){i=this.getLinks().filter(function(e){return t===e.getNode()});if(i.length){e=i[0]}}return e}};GridUserOptions=function(t,e,i,n){this.options=null;this.actions=null;this.parent=null;this.url=null;this.init(t,e,i,n)};GridUserOptions.prototype={init:function(t,e,i,n){this.url=n;this.parent=t;try{this.options=JSON.parse(e)}catch(s){console.warn("GridUserOptions.init: Failed parse user options json string")}try{this.actions=JSON.parse(i)}catch(s){console.warn("GridUserOptions.init: Failed parse user options actions json string")}},getCurrentViewName:function(){var t=this.getOptions();return"current_view"in t?t.current_view:null},getViewsList:function(){var t=this.getOptions();return"views"in t?t.views:{}},getCurrentOptions:function(){var t=this.getCurrentViewName();var e=this.getViewsList();var i=null;if(t in e){i=e[t]}return i},getUrl:function(t){return BX.util.add_url_param(this.url,{GRID_ID:this.parent.getContainerId(),bxajaxid:this.parent.getAjaxId(),action:t})},getOptions:function(){return this.options||{}},getActions:function(){return this.actions},getAction:function(t){var e=null;try{e=this.getActions()[t]}catch(i){e=null}return e},update:function(t){this.options=t},setColumns:function(t,e){var i=this.getCurrentOptions();if(BX.type.isPlainObject(i)){i.columns=t.join(",");this.save(this.getAction("GRID_SET_COLUMNS"),{columns:i.columns},e)}return this},setColumnSizes:function(t,e){this.save(this.getAction("GRID_SET_COLUMN_SIZES"),{sizes:t,expand:e})},setSort:function(t,e,i){if(t&&e){this.save(this.getAction("GRID_SET_SORT"),{by:t,order:e},i)}return this},setPageSize:function(t,e){if(BX.type.isNumber(parseInt(t))){this.save(this.getAction("GRID_SET_PAGE_SIZE"),{pageSize:t},e)}},save:function(t,e,i){var n=this;BX.ajax.post(this.getUrl(t),e,function(t){try{t=JSON.parse(t);if(!t.error){n.update(t);if(BX.type.isFunction(i)){i(t)}BX.onCustomEvent(n.parent.getContainer(),"Grid::optionsChanged",[n.parent])}}catch(e){}})}};GridFader=function(t){this.parent=null;this.table=null;this.container=null;this.init(t)};GridFader.prototype={init:function(t){this.parent=t;this.table=this.parent.getTable();this.container=this.parent.getFadeContainer();this.toggle()},toggle:function(){if(this.table.offsetWidth>this.container.clientWidth){if(this.container.scrollLeft>0){BX.addClass(this.container.parentNode,this.parent.settings.get("classFadeContainerLeft"))}else{BX.removeClass(this.container.parentNode,this.parent.settings.get("classFadeContainerLeft"))}if(this.table.offsetWidth>this.container.scrollLeft+this.container.clientWidth){BX.addClass(this.container.parentNode,this.parent.settings.get("classFadeContainerRight"))}else{BX.removeClass(this.container.parentNode,this.parent.settings.get("classFadeContainerRight"))}}else{BX.removeClass(this.container.parentNode,this.parent.settings.get("classFadeContainerLeft"));BX.removeClass(this.container.parentNode,this.parent.settings.get("classFadeContainerRight"))}}};GridColsSortable=function(t){this.parent=null;this.dragItem=null;this.targetItem=null;this.rowsList=null;this.colsList=null;this.dragRect=null;this.offset=null;this.startDragOffset=null;this.dragColumn=null;this.targetColumn=null;this.isDrag=null;this.init(t)};GridColsSortable.prototype={init:function(t){var e,i;var n=this;this.parent=t;this.colsList=this.getColsList();this.rowsList=this.parent.getRows().getSourceRows();if(this.isPinned&&this.parent.getParam("ALLOW_PIN_HEADER")){e=this.parent.getPinHeader().getFixedTable();i=BX.findChild(e,{tag:"tr"},true,true);(i||[]).forEach(function(t){n.rowsList.push(t)})}this.registerObjects();if(!this.inited){this.inited=true;BX.addCustomEvent("Grid::headerPinned",BX.delegate(this._onPin,this));BX.addCustomEvent("Grid::headerUnpinned",BX.delegate(this._onUnpin,this))}},_onPin:function(){this.isPinned=true;this.reinit()},_onUnpin:function(){this.isPinned=false;this.reinit()},reinit:function(){this.unregisterObjects();this.reset();this.init(this.parent)},reset:function(){this.dragItem=null;this.targetItem=null;this.rowsList=null;this.colsList=null;this.dragRect=null;this.offset=null;this.startDragOffset=null;this.dragColumn=null;this.targetColumn=null;this.isDrag=null},isActive:function(){return this.isDrag},registerObjects:function(t){var e=this;[].forEach.call(t||this.colsList,function(t){t.onbxdragstart=BX.delegate(e._onDragStart,e);t.onbxdrag=BX.delegate(e._onDrag,e);t.onbxdragstop=BX.delegate(e._onDragEnd,e);jsDD.registerObject(t);jsDD.registerDest(t)})},unregisterObjects:function(){[].forEach.call(this.colsList,function(t){jsDD.unregisterObject(t);jsDD.unregisterDest(t)})},getColsList:function(){var t=this;var e=[];var i;if(this.isPinned&&this.parent.getParam("ALLOW_PIN_HEADER")){i=this.parent.getPinHeader().getFixedTable();e=BX.findChild(i,{tag:"th"},true,true)}else{e=this.parent.getRows().getHeadFirstChild().getCells()}e=[].filter.call(e,function(e){return!t.isStatic(e)});return e},isStatic:function(t){return BX.hasClass(t,this.parent.settings.get("classCellStatic"))},getDragOffset:function(){return jsDD.x-this.startDragOffset-this.dragRect.left},getColumn:function(t){var e=GridUtils.getColumn(this.parent.getTable(),t);if(e.indexOf(t)===-1){e.push(t)}return e},_onDragStart:function(){this.isDrag=true;this.dragItem=jsDD.current_node;this.dragRect=this.dragItem.getBoundingClientRect();this.offset=this.dragRect.width;this.startDragOffset=jsDD.start_x-this.dragRect.left;this.dragColumn=this.getColumn(this.dragItem);this.dragIndex=GridUtils.getIndex(this.colsList,this.dragItem)},_onDrag:function(){var t,e;var i=this;this.dragOffset=this.getDragOffset();this.targetItem=this.targetItem||this.dragItem;this.targetColumn=this.targetColumn||this.dragColumn;GridUtils.styleForEach(this.dragColumn,{transition:"0ms",transform:"translate3d("+this.dragOffset+"px, 0px, 0px)"});[].forEach.call(this.colsList,function(n,s){if(n){t=n.getBoundingClientRect();e=t.left+t.width/2+BX.scrollLeft(window);if(s>i.dragIndex&&jsDD.x>e&&n.style.transform!=="translate3d("+-i.offset+"px, 0px, 0px)"){i.targetColumn=i.getColumn(n);GridUtils.styleForEach(i.targetColumn,{transition:"300ms",transform:"translate3d("+-i.offset+"px, 0px, 0px)"})}if(s<i.dragIndex&&jsDD.x<e&&n.style.transform!=="translate3d("+i.offset+"px, 0px, 0px)"){i.targetColumn=i.getColumn(n);GridUtils.styleForEach(i.targetColumn,{transition:"300ms",transform:"translate3d("+i.offset+"px, 0px, 0px)"})}if(s>i.dragIndex&&jsDD.x<e&&n.style.transform!==""&&n.style.transform!=="translate3d(0px, 0px, 0px)"||n.style.transform!==""&&(s<i.dragIndex&&jsDD.x>e&&n.style.transform!=="translate3d(0px, 0px, 0px)")){i.targetColumn=i.getColumn(n);GridUtils.styleForEach(i.targetColumn,{transition:"300ms",transform:"translate3d(0px, 0px, 0px)"})}}})},_onDragEnd:function(){var t=this;var e=[];[].forEach.call(this.dragColumn,function(e,i){GridUtils.collectionSort(e,t.targetColumn[i])});[].forEach.call(this.rowsList,function(t){GridUtils.styleForEach(t.cells,{transition:"",transform:""})});this.reinit();[].forEach.call(this.colsList,function(t){e.push(BX.data(t,"name"))});this.parent.getUserOptions().setColumns(e);BX.onCustomEvent(this.parent.getContainer(),"Grid::columnMoved",[this.parent])}};GridRowsSortable=function(t){this.parent=null;this.list=null;this.setDefaultProps();this.init(t)};GridRowsSortable.prototype={init:function(t){this.parent=t;this.list=this.getList();this.prepareListItems();jsDD.Enable();if(!this.inited){this.inited=true;BX.addCustomEvent("Grid::thereEditedRows",BX.delegate(this.disable,this));BX.addCustomEvent("Grid::noEditedRows",BX.delegate(this.enable,this))}},disable:function(){this.unregisterObjects()},enable:function(){this.reinit()},reinit:function(){this.unregisterObjects();this.setDefaultProps();this.init(this.parent)},getList:function(){return this.parent.getRows().getSourceBodyChild()},unregisterObjects:function(){this.list=this.list.map(function(t){jsDD.unregisterObject(t);jsDD.unregisterDest(t);return t})},prepareListItems:function(){var t=this;console.time("prepare");this.list=this.list.map(function(e){e.onbxdragstart=BX.delegate(t._onDragStart,t);e.onbxdrag=BX.delegate(t._onDrag,t);e.onbxdragstop=BX.delegate(t._onDragEnd,t);jsDD.registerObject(e);jsDD.registerDest(e);return e});console.timeEnd("prepare")},getIndex:function(t){return GridUtils.getIndex(this.list,t)},_onDragStart:function(){this.dragItem=jsDD.current_node;this.dragIndex=this.getIndex(this.dragItem);this.dragRect=this.dragItem.getBoundingClientRect();this.offset=this.dragRect.height;this.dragStartOffset=jsDD.start_y-(this.dragRect.top+BX.scrollTop(window));GridUtils.styleForEach(this.list,{transition:+this.parent.settings.get("animationDuration")+"ms"});BX.bind(document,"mousemove",BX.delegate(this._onMouseMove,this));BX.addClass(this.parent.getContainer(),this.parent.settings.get("classOnDrag"));BX.addClass(this.dragItem,this.parent.settings.get("classDragActive"))},_onMouseMove:function(t){this.realX=t.clientX;this.realY=t.clientY},_onDrag:function(){var t=this;var e,i;this.dragOffset=this.realY-this.dragRect.top-this.dragStartOffset;this.sortOffset=t.realY+BX.scrollTop(window);GridUtils.styleForEach([this.dragItem],{transition:"0ms",transform:"translate3d(0px, "+this.dragOffset+"px, 0px)"});this.list.forEach(function(n,s){if(n){e=n.getBoundingClientRect();i=e.top+BX.scrollTop(window)+e.height/2;if(s>t.dragIndex&&t.sortOffset>i&&n.style.transform!=="translate3d(0px, "+-t.offset+"px, 0px)"&&n.style.transform!==""){t.targetItem=n;BX.style(n,"transform","translate3d(0px, "+-t.offset+"px, 0px)")}if(s<t.dragIndex&&t.sortOffset<i&&n.style.transform!=="translate3d(0px, "+t.offset+"px, 0px)"&&n.style.transform!==""){
t.targetItem=n;BX.style(n,"transform","translate3d(0px, "+t.offset+"px, 0px)")}if((s<t.dragIndex&&t.sortOffset>i||s>t.dragIndex&&t.sortOffset<i)&&n.style.transform!=="translate3d(0px, 0px, 0px)"){if(n.style.transform!==""){t.targetItem=n}BX.style(n,"transform","translate3d(0px, 0px, 0px)")}}})},_onDragOver:function(){},_onDragLeave:function(){},_onDragEnd:function(){BX.unbind(document,"mousemove",BX.delegate(this._onMouseMove,this));BX.removeClass(this.parent.getContainer(),this.parent.settings.get("classOnDrag"));BX.removeClass(this.dragItem,this.parent.settings.get("classDragActive"));GridUtils.styleForEach(this.list,{transition:"",transform:""});GridUtils.collectionSort(this.dragItem,this.targetItem);this.list=this.getList();this.setDefaultProps();BX.onCustomEvent(this.parent.getContainer(),"Grid::rowMoved",[this.parent])},setDefaultProps:function(){this.dragItem=null;this.targetItem=null;this.dragRect=null;this.dragIndex=null;this.offset=null;this.sortOffset=null;this.realX=null;this.realY=null;this.dragStartOffset=null;this.sortOffset=null}};GridUtils={ajaxUrl:function(t,e){return this.addUrlParams(t,{bxajaxid:e})},addUrlParams:function(t,e){return BX.util.add_url_param(t,e)},arrayMove:function(t,e,i){if(i>=t.length){var n=i-t.length;while(n--+1){t.push(undefined)}}t.splice(i,0,t.splice(e,1)[0]);return t},getIndex:function(t,e){return[].indexOf.call(t||[],e)},getNext:function(t){if(t){return t.nextElementSibling||null}},getPrev:function(t){if(t){return t.previousElementSibling||null}},closestParent:function(t,e){if(t){if(!e){return t.parentNode||null}else{return BX.findParent(t,{"class":e})}}},closestChilds:function(t){if(t){return t.children||null}},collectionSort:function(t,e){var i,n,s,a,r;if(t&&e&&t!==e&&t.parentNode===e.parentNode){i=this.closestParent(e);n=this.closestChilds(i);s=n.length;a=this.getIndex(n,t);r=this.getIndex(n,e);if(s===r){i.appendChild(e)}if(a>r){i.insertBefore(t,e)}if(a<r&&s!==r){i.insertBefore(t,this.getNext(e))}}},getColumn:function(t,e){var i=this.getIndex(this.closestChilds(this.closestParent(e)),e);var n=[];[].forEach.call(t.rows,function(t){n.push(t.cells[i])});return n},styleForEach:function(t,e){e=BX.type.isPlainObject(e)?e:null;var i=Object.keys(e);[].forEach.call(t||[],function(t){i.forEach(function(i){BX.style(t,i,e[i])})})}};GridBaseClass=function(t){this.parent=t};GridBaseClass.prototype={getParent:function(){return this.parent}};GridData=function(t){GridData.superclass.constructor.apply(this,[t]);this.reset()};BX.extend(GridData,GridBaseClass);{GridData.prototype=Object.create(GridBaseClass.prototype,{});GridData.prototype.reset=function(){this.response=null;this.xhr=null;this.headRows=null;this.bodyRows=null;this.footRows=null;this.moreButton=null;this.pagination=null;this.counterDisplayed=null;this.counterSelected=null;this.counterTotal=null;this.limit=null;this.actionPanel=null};GridData.prototype.request=function(t,e,i,n,s,a){if(!BX.type.isString(t)){t=""}if(!BX.type.isNotEmptyString(e)){e="GET"}if(!BX.type.isPlainObject(i)){i={}}var r={gridId:this.parent.getId(),url:t,method:e,data:i};BX.onCustomEvent(window,"Grid::beforeRequest",[this,r]);t=r.url;if(!BX.type.isNotEmptyString(t)){t=window.location.pathname+window.location.search}t=GridUtils.addUrlParams(t,{sessid:BX.bitrix_sessid(),internal:"true"});e=r.method;i=r.data;this.reset();var o=this;setTimeout(function(){var r=BX.ajax({url:GridUtils.ajaxUrl(t,o.getParent().getAjaxId()),data:i,method:e,dataType:"html",headers:[{name:"X-Ajax-Grid-UID",value:o.getParent().getAjaxId()},{name:"X-Ajax-Grid-Req",value:JSON.stringify({action:n||"showpage"})}],processData:false,scriptsRunFirst:false,onsuccess:function(t){o.response=BX.create("div",{html:t});o.xhr=r;if(BX.type.isFunction(s)){BX.delegate(s,o)(t,r)}},onerror:function(t){o.error=a;o.xhr=r;if(BX.type.isFunction(a)){BX.delegate(a,o)(r,t)}}})},0)};GridData.prototype.getResponse=function(){return this.response};GridData.prototype.getHeadRows=function(){this.headRows=this.headRows||BX.findChild(this.getResponse(),{"class":this.getParent().settings.get("classHeadRow")},true,true);return this.headRows};GridData.prototype.getBodyRows=function(){this.bodyRows=this.bodyRows||BX.findChild(this.getResponse(),{"class":this.getParent().settings.get("classBodyRow")},true,true);return this.bodyRows};GridData.prototype.getFootRows=function(){this.footRows=this.footRows||BX.findChild(this.getResponse(),{"class":this.getParent().settings.get("classFootRow")},true,true);return this.footRows};GridData.prototype.getMoreButton=function(){this.moreButton=this.moreButton||BX.findChild(this.getResponse(),{"class":this.getParent().settings.get("classMoreButton")},true,false);return this.moreButton};GridData.prototype.getPagination=function(){if(!this.pagination){this.pagination=BX.findChild(this.getResponse(),{"class":this.getParent().settings.get("classPagination")},true,false);if(BX.type.isDomNode(this.pagination)){this.pagination=BX.firstChild(this.pagination)}}return this.pagination};GridData.prototype.getCounterDisplayed=function(){this.counterDisplayed=this.counterDisplayed||BX.findChild(this.getResponse(),{"class":this.getParent().settings.get("classCounterDisplayed")},true,false);return this.counterDisplayed};GridData.prototype.getCounterSelected=function(){this.counterSelected=this.counterSelected||BX.findChild(this.getResponse(),{"class":this.getParent().settings.get("classCounterSelected")},true,false);return this.counterSelected};GridData.prototype.getCounterTotal=function(){this.counterTotal=this.counterTotal||BX.findChild(this.getResponse(),{"class":this.getParent().settings.get("classCounterTotal")},true,false);return this.counterTotal};GridData.prototype.getLimit=function(){this.limit=this.limit||BX.findChild(this.getResponse(),{"class":this.getParent().settings.get("classPageSize")},true,false);return this.limit};GridData.prototype.getActionPanel=function(){this.actionPanel=this.actionPanel||BX.findChild(this.getResponse(),{"class":this.getParent().settings.get("classActionPanel")},true,false);return this.actionPanel}}GridUpdater=function(t){GridUpdater.superclass.constructor.apply(this,[t]);this.reset()};BX.extend(GridUpdater,GridBaseClass);{GridUpdater.prototype=Object.create(GridBaseClass.prototype,{});GridUpdater.prototype.reset=function(){this.head=null;this.body=null;this.foot=null;this.moreButton=null;this.pagination=null;this.counterDisplayed=null;this.counterSelected=null;this.counterTotal=null;this.limit=null;this.actionPanel=null};GridUpdater.prototype.updateHeadRows=function(t){var e;if(BX.type.isArray(t)&&t.length){e=this.getParent().getHeaders();e.forEach(function(e){e=BX.cleanNode(e);t.forEach(function(t){if(BX.type.isDomNode(t)){e.appendChild(BX.clone(t))}})})}};GridUpdater.prototype.appendHeadRows=function(t){var e;if(BX.type.isArray(t)&&t.length){e=this.getParent().getHeaders();e.forEach(function(e){t.forEach(function(t){if(BX.type.isDomNode(t)){e.appendChild(BX.clone(t))}})})}};GridUpdater.prototype.prependHeadRows=function(t){var e;if(BX.type.isArray(t)&&t.length){e=this.getParent().getHeaders();e.forEach(function(e){e=BX.cleanNode(e);t.forEach(function(t){if(BX.type.isDomNode(t)){e.prepend(BX.clone(t))}})})}};GridUpdater.prototype.updateBodyRows=function(t){var e;if(BX.type.isArray(t)){e=BX.cleanNode(this.getParent().getBody());t.forEach(function(t){if(BX.type.isDomNode(t)){e.appendChild(t)}})}};GridUpdater.prototype.appendBodyRows=function(t){var e;if(BX.type.isArray(t)){e=this.getParent().getBody();t.forEach(function(t){if(BX.type.isDomNode(t)){e.appendChild(t)}})}};GridUpdater.prototype.prependHeadRows=function(t){var e;if(BX.type.isArray(t)){e=this.getParent().getHead();t.forEach(function(t){if(BX.type.isDomNode(t)){BX.prepend(e,t)}})}};GridUpdater.prototype.updateFootRows=function(t){var e;if(BX.type.isArray(t)){e=BX.cleanNode(this.getParent().getFoot());t.forEach(function(t){if(BX.type.isDomNode(t)){e.appendChild(t)}})}};GridUpdater.prototype.updatePagination=function(t){var e;if(BX.type.isDomNode(t)){e=BX.cleanNode(this.getParent().getPagination().getContainer());e.appendChild(t)}};GridUpdater.prototype.updateMoreButton=function(t){var e=GridUtils.closestParent(this.getParent().getMoreButton().getNode());if(BX.type.isDomNode(t)){if(BX.isNodeHidden(e)){BX.show(e)}e=BX.cleanNode(e);e.appendChild(t)}else{BX.hide(e)}}}GridPageSize=function(t){this.parent=null;this.init(t)};GridPageSize.prototype={init:function(t){this.parent=t;BX.addCustomEvent("Dropdown::change",BX.delegate(this.onChange,this))},onChange:function(t,e,i,n,s){var a=this;if(t===this.parent.getContainerId()+"_"+this.parent.settings.get("pageSizeId")){if(s>0){this.parent.tableFade();this.parent.getUserOptions().setPageSize(s,function(){a.parent.reloadTable();BX.onCustomEvent(a.parent.getContainer(),"Grid::pageSizeChanged",[a.parent])})}}}};GridActionPanel=function(t,e,i){this.parent=null;this.rel={};this.actions=null;this.types=null;this.lastActivated=[];this.init(t,e,i)};GridActionPanel.prototype={init:function(t,e,i){this.parent=t;try{this.actions=JSON.parse(e);this.types=JSON.parse(i)}catch(n){}this.bindOnChange()},getPanel:function(){return BX.findChild(this.parent.getContainer(),{"class":this.parent.settings.get("classActionPanel")},true,false)},getApplyButton:function(){return BX.findChild(this.getPanel(),{"class":this.parent.settings.get("classPanelApplyButton")},true,false)},bindOnChange:function(){var t=this;var e=this.getPanel();BX.addCustomEvent(window,"Dropdown::change",function(e,i,n,s,a){if(t.isPanelControl(BX(e))){t._dropdownChange(e,i,n,s,a)}});BX.addCustomEvent(window,"Dropdown::load",function(e,i,n,s,a){if(t.isPanelControl(BX(e))){t._dropdownChange(e,i,n,s,a)}});BX.bind(e,"change",BX.delegate(this._checkboxChange,this));BX.bind(e,"click",BX.delegate(this._clickOnButton,this))},isPanelControl:function(t){return BX.hasClass(t,this.parent.settings.get("classPanelControl"))},getTextInputs:function(){return BX.findChild(this.getPanel(),{type:"text"},true,true)},getDropdowns:function(){return BX.findChild(this.getPanel(),{"class":this.parent.settings.get("classDropdown")},true,true)},getCheckboxes:function(){return BX.findChild(this.getPanel(),{"class":this.parent.settings.get("classPanelCheckbox")},true,true)},isDropdown:function(t){return BX.hasClass(t,this.parent.settings.get("classDropdown"))},isCheckbox:function(t){return BX.hasClass(t,this.parent.settings.get("classPanelCheckbox"))},isTextInput:function(t){return t.type==="text"},createDropdown:function(t,e){var i=this.createContainer(t.ID,e);var n=BX.create("div",{props:{className:"main-dropdown main-grid-panel-control",id:t.ID+"_control"},attrs:{name:t.NAME,"data-items":JSON.stringify(t.ITEMS),"data-value":t.ITEMS[0].VALUE},html:t.ITEMS[0].NAME});i.appendChild(n);return i},createCheckbox:function(t,e){var i=this.createContainer(t.ID,e);var n=BX.create("span",{props:{className:"main-grid-checkbox-container"}});var s=BX.create("span",{props:{className:"main-grid-control-panel-content-title"}});var a=BX.create("input",{props:{type:"checkbox",className:this.parent.settings.get("classPanelCheckbox")+" main-grid-checkbox",id:t.ID+"_control"},attrs:{value:t.VALUE||"",title:t.TITLE||"",name:t.NAME||"","data-onchange":JSON.stringify(t.ONCHANGE)}});a.checked=t.CHECKED||null;i.appendChild(n);i.appendChild(s);n.appendChild(a);n.appendChild(BX.create("label",{props:{className:"main-grid-checkbox"},attrs:{"for":t.ID+"_control",title:t.TITLE}}));s.appendChild(BX.create("label",{attrs:{"for":t.ID+"_control",title:t.TITLE},html:t.LABEL}));return i},createText:function(t,e){var i=this.createContainer(t.ID,e);var n=BX.create("label",{attrs:{title:t.TITLE||"","for":t.ID+"_control"}});var s=BX.create("input",{props:{className:"main-grid-control-panel-input-text main-grid-panel-control",id:t.ID+"_control"},attrs:{name:t.NAME,title:t.TITLE||"",placeholder:t.PLACEHOLDER||"",value:t.VALUE||"","data-onchange":JSON.stringify(t.ONCHANGE||[])}});i.appendChild(n);i.appendChild(s);return i},createHidden:function(t,e){var i=this.createContainer(t.ID,e);i.appendChild(BX.create("input",{props:{id:t.ID+"_control",type:"hidden"},attrs:{name:t.NAME,value:t.VALUE||""}}));return i},createButton:function(t,e){var i=this.createContainer(t.ID,e);var n=BX.create("button",{props:{className:"main-grid-buttons"+(t.CLASS?" "+t.CLASS:""),id:t.id+"_control"},attrs:{name:t.NAME||"","data-onchange":JSON.stringify(t.ONCHANGE||[])},html:t.TEXT});i.appendChild(n);return i},createLink:function(t,e){var i=this.createContainer(t.ID,e);var n=BX.create("a",{props:{className:"main-grid-link"+(t.CLASS?" "+t.CLASS:""),id:t.ID+"_control"},attrs:{href:t.HREF||"","data-onchange":JSON.stringify(t.ONCHANGE||[])},html:t.TEXT});i.appendChild(n);return i},createCustom:function(t,e){},createContainer:function(t,e){t=t.replace("_control","");e=e.replace("_control","");return BX.create("span",{props:{className:this.parent.settings.get("classPanelControlContainer"),id:t},attrs:{"data-relative":e}})},removeItemsRelativeCurrent:function(t){var e=t;var i=t.id;var n=[];var s;while(e){s=BX.data(e,"relative");if(s===i||s===t.id){i=e.id;n.push(e)}e=e.nextElementSibling}n.forEach(function(t){BX.remove(t)})},validateData:function(t){return"ONCHANGE"in t&&BX.type.isArray(t.ONCHANGE)},activateControl:function(t){var e=BX(t);if(BX.type.isDomNode(e)){BX.removeClass(e,this.parent.settings.get("classDisable"));e.disabled=null}},deactivateControl:function(t){var e=BX(t);if(BX.type.isDomNode(e)){BX.addClass(e,this.parent.settings.get("classDisable"));e.disabled=true}},showControl:function(t){var e=BX(t);if(BX.type.isDomNode(e)){BX.show(e)}},hideControl:function(t){var e=BX(t);if(BX.type.isDomNode(e)){BX.hide(e)}},validateActionObject:function(t){return BX.type.isPlainObject(t)&&"ACTION"in t&&BX.type.isNotEmptyString(t.ACTION)&&"DATA"in t&&BX.type.isArray(t.DATA)},validateControlObject:function(t){return BX.type.isPlainObject(t)&&"TYPE"in t&&"ID"in t},createControl:function(t,e){var i;switch(t.TYPE){case this.types.DROPDOWN:{i=this.createDropdown(t,e);break}case this.types.CHECKBOX:{i=this.createCheckbox(t,e);break}case this.types.TEXT:{i=this.createText(t,e);break}case this.types.HIDDEN:{i=this.createHidden(t,e);break}case this.types.BUTTON:{i=this.createButton(t,e);break}case this.types.LINK:{i=this.createLink(t,e);break}case this.types.CUSTOM:{i=this.createCustom(t,e);break}default:{break}}return i},onChangeHandler:function(container,actions){var newElement,callback;var self=this;if(BX.type.isDomNode(container)&&BX.type.isArray(actions)){actions.forEach(function(action){if(self.validateActionObject(action)){if(action.ACTION===self.actions.CREATE){self.removeItemsRelativeCurrent(container);action.DATA.reverse();action.DATA.forEach(function(t){if(self.validateControlObject(t)){newElement=self.createControl(t,BX.data(container,"relative")||container.id);if(BX.type.isDomNode(newElement)){BX.insertAfter(newElement,container);if("ONCHANGE"in t&&t.TYPE===self.types.CHECKBOX&&"CHECKED"in t&&t.CHECKED){self.onChangeHandler(newElement,t.ONCHANGE)}if(t.TYPE===self.types.DROPDOWN&&BX.type.isArray(t.ITEMS)&&t.ITEMS.length&&"ONCHANGE"in t.ITEMS[0]&&BX.type.isArray(t.ITEMS[0].ONCHANGE)){self.onChangeHandler(newElement,t.ITEMS[0].ONCHANGE)}}}})}if(action.ACTION===self.actions.ACTIVATE){self.removeItemsRelativeCurrent(container);if(BX.type.isArray(action.DATA)){action.DATA.forEach(function(t){self.lastActivated.push(t.ID);self.activateControl(t.ID)})}}if(action.ACTION===self.actions.SHOW){if(BX.type.isArray(action.DATA)){action.DATA.forEach(function(t){self.showControl(t.ID)})}}if(action.ACTION===self.actions.HIDE){if(BX.type.isArray(action.DATA)){action.DATA.forEach(function(t){self.hideControl(t.ID)})}}if(action.ACTION===self.actions.HIDE_ALL_EXPECT){if(BX.type.isArray(action.DATA)){(self.getControls()||[]).forEach(function(t){if(!action.DATA.some(function(e){return e.ID===t.id})){self.hideControl(t.id)}})}}if(action.ACTION===self.actions.SHOW_ALL){(self.getControls()||[]).forEach(function(t){self.showControl(t.id)})}if(action.ACTION===self.actions.REMOVE){if(BX.type.isArray(action.DATA)){action.DATA.forEach(function(t){BX.remove(BX(t.ID))})}}if(action.ACTION===self.actions.CALLBACK){if(BX.type.isArray(action.DATA)){action.DATA.forEach(function(currentCallback){if(currentCallback.JS.indexOf("Grid.")!==-1){callback=currentCallback.JS.replace("Grid","self.parent");try{eval(callback)}catch(err){console.log(err)}}})}}}})}else{this.removeItemsRelativeCurrent(container);self.lastActivated.forEach(function(t){self.deactivateControl(t)});self.lastActivated=[]}},_dropdownChange:function(t,e,i,n){var s=BX(t);var a=s.parentNode;var r=n&&"ONCHANGE"in n?n.ONCHANGE:null;this.onChangeHandler(a,r)},_checkboxChange:function(t){var e;try{e=JSON.parse(BX.data(t.target,"onchange"))}catch(i){e=null}this.onChangeHandler(BX.findParent(t.target,{className:this.parent.settings.get("classPanelContainer")},true,false),t.target.checked?e:null)},_clickOnButton:function(t){var e;if(this.isButton(t.target)){t.preventDefault();try{e=JSON.parse(BX.data(t.target,"onchange"))}catch(i){e=null}this.onChangeHandler(BX.findParent(t.target,{className:this.parent.settings.get("classPanelContainer")},true,false),e)}},isButton:function(t){return BX.hasClass(t,this.parent.settings.get("classPanelButton"))},getSelectedIds:function(){var t=this.parent.getRows().getSelected();return t.map(function(t){return t.getId()})},getRequestData:function(){return{panel:this.getValues(),selectedRows:this.getSelectedIds()}},getControls:function(){var t=BX.findChild(this.getPanel(),{className:this.parent.settings.get("classPanelControlContainer")},true,true);return t},getValues:function(){var t={};var e=this;var i=[].concat(this.getDropdowns(),this.getTextInputs(),this.getCheckboxes());(i||[]).forEach(function(i){if(BX.type.isDomNode(i)){if(e.isDropdown(i)){t[i.getAttribute("name")]=BX.data(i,"value")}if(e.isCheckbox(i)&&i.checked){t[i.getAttribute("name")]=i.value}if(e.isTextInput(i)){t[i.getAttribute("name")]=i.value}}});return t}};GridPinHeader=function(t){this.parent=null;this.fixedTable=null;this.header=null;this.init(t)};GridPinHeader.prototype={init:function(t){this.parent=t;this.fixedTable=this.getFixedTable();this.bindOnScroll()},bindOnScroll:function(){BX.bind(window,"scroll",BX.delegate(this._onScroll,this))},getFixedTable:function(){if(!BX.type.isDomNode(this.fixedTable)){this.fixedTable=BX.create("table",{props:{className:"main-grid-fixed-top main-grid-table"}});this.parent.getScrollContainer().appendChild(this.fixedTable)}return this.fixedTable},checkHeaderPosition:function(){var t=this.getHeader().getBoundingClientRect();return t.top<=0},getHeader:function(){this.header=this.header||this.parent.getHead();return this.header},pinHeader:function(){var t=this.getFixedTable();var e=BX.clone(this.getHeader());if(!this.isPinned()){t.appendChild(e);BX.style(t,"top",BX.scrollTop(window)-BX.pos(this.getHeader()).top+"px");BX.onCustomEvent(window,"Grid::headerPinned",[])}else{BX.style(t,"top",BX.scrollTop(window)-BX.pos(this.getHeader()).top+"px")}},unpinHeader:function(){if(this.isPinned()){BX.html(this.getFixedTable(),"");BX.onCustomEvent(window,"Grid::headerUnpinned",[])}},isPinned:function(){return this.getFixedTable().children.length},_onScroll:function(){if(this.checkHeaderPosition()){this.pinHeader()}else{this.unpinHeader()}}};GridPinPanel=function(t){this.parent=null;this.panel=null;this.panelRect=null;this.isSelected=null;this.offset=null;this.animationDuration=null;this.lastIsSelected=null;this.init(t)};GridPinPanel.prototype={init:function(t){this.parent=t;this.offset=10;this.animationDuration=200;this.panel=this.getPanel();this.bindOnRowsEvents()},bindOnRowsEvents:function(){BX.addCustomEvent("Grid::thereSelectedRows",BX.delegate(this._onThereSelectedRows,this));BX.addCustomEvent("Grid::allRowsSelected",BX.delegate(this._onThereSelectedRows,this));BX.addCustomEvent("Grid::noSelectedRows",BX.delegate(this._onNoSelectedRows,this));BX.addCustomEvent("Grid::allRowsUnselected",BX.delegate(this._onNoSelectedRows,this));BX.addCustomEvent("Grid::updated",BX.delegate(this._onNoSelectedRows,this))},bindOnWindowEvents:function(){BX.bind(window,"resize",BX.delegate(this._onResize,this));BX.bind(window,"scroll",BX.delegate(this._onScroll,this))},unbindOnWindowEvents:function(){BX.unbind(window,"resize",BX.delegate(this._onResize,this));BX.unbind(window,"scroll",BX.delegate(this._onScroll,this))},getPanel:function(){this.panel=this.panel||this.parent.getActionsPanel().getPanel();return this.panel},getScrollBottom:function(){return BX.scrollTop(window)+this.getWindowHeight()},getPanelRect:function(){this.panelRect=this.panelRect||this.getPanel().getBoundingClientRect();return this.panelRect},getPanelPrevBottom:function(){var t=BX.previousSibling(this.getPanel());return BX.pos(t).bottom+parseFloat(BX.style(t,"margin-bottom"))},getWindowHeight:function(){this.windowHeight=this.windowHeight||BX.height(window);return this.windowHeight},pinPanel:function(){BX.style(this.getPanel(),"width",BX.width(this.getPanel().parentNode)+"px");BX.style(this.getPanel().parentNode,"height",BX.height(this.getPanel().parentNode)+"px");BX.addClass(this.getPanel(),"main-grid-fixed-bottom");BX.style(this.getPanel(),"bottom","")},unpinPanel:function(){BX.removeClass(this.getPanel(),"main-grid-fixed-bottom");BX.style(this.getPanel(),"width","");BX.style(this.getPanel().parentNode,"height","");BX.style(this.getPanel(),"bottom","")},isSelectedRows:function(){return this.isSelected},isNeedPinAbsolute:function(){return BX.pos(this.parent.getBody()).top+this.getPanelRect().height>=this.getScrollBottom()},isNeedPin:function(){return this.getScrollBottom()-this.getPanelRect().height<=this.getPanelPrevBottom()},pinController:function(t){if(!this.getPanel()){return}var e=this;if(this.isNeedPin()&&this.isSelectedRows()){if(t){BX.style(this.getPanel(),"bottom",-this.getStartDiffPanelPosition()+"px");setTimeout(function(){e.pinPanel()},200)}else{this.pinPanel()}if(this.isNeedPinAbsolute()&&!this.absolutePin){this.absolutePin=true;BX.style(this.getPanel(),"transition","");BX.style(this.getPanel(),"top",BX.pos(this.parent.getBody()).top-parseFloat(BX.style(this.getPanel(),"margin-top"))+"px");BX.style(e.getPanel(),"position","absolute")}else if(!this.isNeedPinAbsolute()&&this.absolutePin){this.absolutePin=false;BX.style(this.getPanel(),"position","");BX.style(this.getPanel(),"top","")}}else{if(t){BX.style(this.getPanel(),"bottom",-this.getEndDiffPanelPosition()+"px");setTimeout(function(){e.unpinPanel()},200)}else{this.unpinPanel()}}},getEndDiffPanelPosition:function(){var t=BX.pos(this.getPanel());var e=BX.pos(BX.previousSibling(this.getPanel()));var i=BX.scrollTop(window);var n=i+BX.height(window);var s=t.height+this.offset;var a=e.bottom+parseFloat(BX.style(this.getPanel(),"margin-top"));if(a<n&&a+t.height>n){s=Math.abs(n-(a+t.height))}return s},getStartDiffPanelPosition:function(){var t=BX.pos(this.getPanel());var e=BX.scrollTop(window);var i=e+BX.height(window);var n=t.height+this.offset;if(t.bottom>i&&t.top<i){n=t.bottom-i}return n},_onThereSelectedRows:function(){this.bindOnWindowEvents();this.isSelected=true;if(this.lastIsSelected){this.pinController()}else{this.lastIsSelected=true;this.pinController(true)}},_onNoSelectedRows:function(){this.unbindOnWindowEvents();this.isSelected=false;this.pinController(true);this.lastIsSelected=false},_onScroll:function(){this.pinController()},_onResize:function(){this.windowHeight=BX.height(window);this.panel=this.parent.getActionsPanel().getPanel();this.panelRect=this.getPanel().getBoundingClientRect();this.pinController()}};BX.Main.grid=function(t,e,i,n,s,a,r,o){this.settings=null;this.containerId="";this.container=null;this.wrapper=null;this.fadeContainer=null;this.scrollContainer=null;this.pagination=null;this.moreButton=null;this.table=null;this.rows=null;this.history=false;this.userOptions=null;this.checkAll=null;this.sortable=null;this.updater=null;this.data=null;this.fader=null;this.oldGrid=null;this.editor=null;this.isEditMode=null;this.pinHeader=null;this.pinPanel=null;this.arParams=null;this.init(t,e,i,n,s,a,r,o)};BX.Main.grid.prototype={init:function(t,e,i,n,s,a,r,o){if(!BX.type.isNotEmptyString(t)){throw"BX.Main.grid.init: parameter containerId is empty"}try{this.arParams=JSON.parse(e)}catch(l){this.arParams={}}this.settings=new GridSettings;this.containerId=t;this.userOptions=new GridUserOptions(this,i,n,s);if(this.getParam("ALLOW_HORIZONTAL_SCROLL")){this.fader=new GridFader(this)}this.pageSize=new GridPageSize(this);if(this.getParam("SHOW_ACTION_PANEL")){this.actionPanel=new GridActionPanel(this,a,r)}this.oldGrid=window["bxGrid_"+this.getContainerId()];this.editor=new GridInlineEditor(this,o);if(this.getParam("ALLOW_PIN_HEADER")){this.pinHeader=new GridPinHeader(this)}if(this.getParam("SHOW_ACTION_PANEL")){this.pinPanel=new GridPinPanel(this)}this.isEditMode=false;if(!BX.type.isDomNode(this.getContainer())){throw"BX.Main.grid.init: Failed to find container with id "+this.getContainerId()}if(!BX.type.isDomNode(this.getTable())){throw"BX.Main.grid.init: Failed to find table"}if(this.getParam("SHOW_ROW_CHECKBOXES")){this.bindOnRowEvents()}this.bindOnMoreButtonEvents();this.bindOnClickPaginationLinks();this.bindOnClickHeader();this.bindOnCheckAll();if(this.getParam("ALLOW_ROWS_SORT")){this.initRowsDragAndDrop()}if(this.getParam("ALLOW_COLUMNS_SORT")){this.initColsDragAndDrop()}this.bindOnClickOnRowActionsMenu();BX.onCustomEvent(this.getContainer(),"Grid::ready",[this])},getParam:function(t,e){if(e===undefined){e=null}return this.arParams.hasOwnProperty(t)?this.arParams[t]:e},getActionKey:function(){return"action_button_"+this.getId()},getPinHeader:function(){this.pinHeader=this.pinHeader||new GridPinHeader(this);return this.pinHeader},editSelected:function(){this.getRows().editSelected()},editSelectedSave:function(){var t={FIELDS:this.getRows().getEditSelectedValues()};t[this.getActionKey()]="edit";this.reloadTable("POST",t)},editSelectedCancel:function(){this.getRows().editSelectedCancel()},removeSelected:function(){var t={ID:this.getRows().getSelectedIds()};t[this.getActionKey()]="delete";this.reloadTable("POST",t)},sendSelected:function(){var t=this.getActionsPanel().getValues();var e=this.getRows().getSelectedIds();var i={rows:e,controls:t};this.reloadTable("POST",i)},getActionsPanel:function(){this.actionPanel=this.actionPanel||new GridActionPanel(this);return this.actionPanel},getApplyButton:function(){return BX.findChild(this.getContainer(),{"class":this.settings.get("classPanelButton")},true,false)},getEditor:function(){return this.editor},reload:function(){this.reloadTable("GET",{})},reloadTable:function(t,e){if(!BX.type.isNotEmptyString(t)){t="GET"}if(!BX.type.isPlainObject(e)){e={}}var i=this;this.tableFade();this.getData().request("",t,e,"",function(){i.getUpdater().updateHeadRows(this.getHeadRows());i.getUpdater().updateBodyRows(this.getBodyRows());i.getUpdater().updateFootRows(this.getFootRows());i.getUpdater().updatePagination(this.getPagination());i.getUpdater().updateMoreButton(this.getMoreButton());if(i.getParam("SHOW_ROW_CHECKBOXES")){i.bindOnRowEvents()}i.bindOnMoreButtonEvents();i.bindOnClickPaginationLinks();i.bindOnClickHeader();i.bindOnCheckAll();i.updateCounterDisplayed();i.updateCounterSelected();if(i.getParam("ALLOW_COLUMNS_SORT")){i.colsSortable.reinit()}if(i.getParam("ALLOW_ROWS_SORT")){i.rowsSortable.reinit()}i.oldGrid.InitTable();i.bindOnClickOnRowActionsMenu();i.tableUnfade();BX.onCustomEvent(window,"Grid::updated",[])})},getGroupEditButton:function(){return BX.findChild(this.getContainer(),{"class":this.settings.get("classGroupEditButton")},true,false)},getGroupDeleteButton:function(){return BX.findChild(this.getContainer(),{"class":this.settings.get("classGroupDeleteButton")},true,false)},enableGroupActions:function(){var t=this.getGroupEditButton();var e=this.getGroupDeleteButton();if(BX.type.isDomNode(t)){BX.removeClass(t,this.settings.get("classGroupActionsDisabled"))}if(BX.type.isDomNode(e)){BX.removeClass(e,this.settings.get("classGroupActionsDisabled"))}},disableGroupActions:function(){var t=this.getGroupEditButton();var e=this.getGroupDeleteButton();if(BX.type.isDomNode(t)){BX.addClass(t,this.settings.get("classGroupActionsDisabled"))}if(BX.type.isDomNode(e)){BX.addClass(e,this.settings.get("classGroupActionsDisabled"))}},getPageSize:function(){return this.pageSize},getFader:function(){return this.fader},getData:function(){this.data=this.data||new GridData(this);return this.data},getUpdater:function(){this.updater=this.updater||new GridUpdater(this);return this.updater},isSortableHeader:function(t){return BX.hasClass(t,this.settings.get("classHeaderSortable"))},bindOnClickHeader:function(){var t=this;var e;BX.bind(this.getScrollContainer(),"click",function(i){e=BX.findParent(i.target,{tag:"th"},true,false);if(e&&t.isSortableHeader(e)){t._clickOnSortableHeader(e,i)}})},enableEditMode:function(){this.isEditMode=true},disableEditMode:function(){this.isEditMode=false},isEditMode:function(){return this.isEditMode},_clickOnSortableHeader:function(t,e){var i=this;e.preventDefault();if(!BX.hasClass(t,this.settings.get("classLoad"))){BX.addClass(t,this.settings.get("classLoad"));this.getUserOptions().setSort(BX.data(t,"sort-by"),BX.data(t,"sort-order"),function(){i.getData().request(BX.data(t,"sort-url"),null,null,"sort",function(){BX.removeClass(t,i.settings.get("classLoad"));i.getUpdater().updateHeadRows(this.getHeadRows());i.getUpdater().updateBodyRows(this.getBodyRows());i.getUpdater().updatePagination(this.getPagination());i.getUpdater().updateMoreButton(this.getMoreButton());if(i.getParam("SHOW_ROW_CHECKBOXES")){i.bindOnRowEvents()}i.bindOnMoreButtonEvents();i.bindOnClickPaginationLinks();i.bindOnClickHeader();i.bindOnCheckAll();i.updateCounterDisplayed();i.updateCounterSelected();if(i.getParam("ALLOW_ROWS_SORT")){i.rowsSortable.reinit()}if(i.getParam("ALLOW_COLUMNS_SORT")){i.colsSortable.reinit()}i.replaceState(BX.data(t,"sort-url"));i.oldGrid.InitTable();i.bindOnClickOnRowActionsMenu();BX.onCustomEvent(i.getContainer(),"Grid::dataSorted",[i.parent]);BX.onCustomEvent(window,"Grid::updated",[])})})}},getObserver:function(){return GridObserver},initRowsDragAndDrop:function(){this.rowsSortable=new GridRowsSortable(this)},initColsDragAndDrop:function(){this.colsSortable=new GridColsSortable(this)},getRowsSortable:function(){return this.rowsSortable},getColsSortable:function(){return this.colsSortable},getUserOptionsHandlerUrl:function(){return this.userOptionsHandlerUrl||""},getUserOptions:function(){return this.userOptions},getCheckAllCheckboxes:function(){var t=BX.findChild(this.getContainer(),{"class":this.settings.get("classCheckAllCheckboxes")},true,true);this.checkAll=t.map(function(t){return new GridElement(t)})||[];return this.checkAll},selectAllCheckAllCheckboxes:function(){this.getCheckAllCheckboxes().forEach(function(t){t.getNode().checked=true})},unselectAllCheckAllCheckboxes:function(){this.getCheckAllCheckboxes().forEach(function(t){t.getNode().checked=false})},bindOnCheckAll:function(){var t=this;this.getCheckAllCheckboxes().forEach(function(e){e.getObserver().add(e.getNode(),"change",t._clickOnCheckAll,t)})},_clickOnCheckAll:function(t){t.preventDefault();if(t.target.checked){this.getRows().selectAll();this.selectAllCheckAllCheckboxes();BX.onCustomEvent(window,"Grid::allRowsSelected",[])}else{this.getRows().unselectAll();this.unselectAllCheckAllCheckboxes();BX.onCustomEvent(window,"Grid::allRowsUnselected",[])}this.updateCounterSelected()},bindOnClickPaginationLinks:function(){var t=this;this.getPagination().getLinks().forEach(function(e){e.getObserver().add(e.getNode(),"click",t._clickOnPaginationLink,t)})},bindOnMoreButtonEvents:function(){var t=this;this.getMoreButton().getObserver().add(this.getMoreButton().getNode(),"click",t._clickOnMoreButton,t)},bindOnRowEvents:function(){var t=this;this.getRows().getBodyChild().forEach(function(e){e.getObserver().add(e.getNode(),"click",t._onClickOnRow,t);

})},bindOnClickOnRowActionsMenu:function(){var t=this;this.getRows().getBodyChild().forEach(function(e){BX.bind(e.getActionsButton(),"click",BX.delegate(t._clickOnRowActionsButton,t))})},_clickOnRowActionsButton:function(t){var e=this.getRows().get(t.target);t.preventDefault();if(!e.actionsMenuIsShown()){e.showActionsMenu()}else{e.closeActionsMenu()}},_onClickOnRow:function(t){var e,i,n,s,a;if(t.target.nodeName!=="A"&&t.target.nodeName!=="INPUT"){if(t.target.nodeName==="LABEL"){t.preventDefault()}i=this.getRows().get(t.target);if(i.getCheckbox()){e=[];this.currentIndex=i.getIndex();this.lastIndex=this.lastIndex||this.currentIndex;if(!t.shiftKey){if(!i.isSelected()){i.select()}else{i.unselect();this.unselectAllCheckAllCheckboxes()}}else{s=Math.min(this.currentIndex,this.lastIndex);a=Math.max(this.currentIndex,this.lastIndex);while(s<=a){e.push(this.getRows().getByIndex(s));s++}n=e.some(function(t){return!t.isSelected()});if(n){e.forEach(function(t){t.select()})}else{e.forEach(function(t){t.unselect()})}}this.updateCounterSelected();this.lastIndex=this.currentIndex}if(this.getRows().isSelected()){BX.onCustomEvent(window,"Grid::thereSelectedRows",[])}else{BX.onCustomEvent(window,"Grid::noSelectedRows",[])}}},getPagination:function(){return new GridPagination(this)},isHistoryApi:function(){this.history=this.history||window.history&&history.pushState;return this.history},pushState:function(t){if(this.isHistoryApi()){window.history.pushState({},"",t)}},replaceState:function(t){if(this.isHistoryApi()&&!this.getParam("PRESERVE_HISTORY",false)){window.history.replaceState({},"",t)}},getState:function(){return window.history.state},tableFade:function(){BX.addClass(this.getTable(),this.settings.get("classTableFade"))},tableUnfade:function(){BX.removeClass(this.getTable(),this.settings.get("classTableFade"))},_clickOnPaginationLink:function(t){t.preventDefault();var e=this;var i=this.getPagination().getLink(t.target);if(!i.isLoad()){i.load();this.tableFade();this.getData().request(i.getLink(),null,null,"pagination",function(){e.getUpdater().updateBodyRows(this.getBodyRows());e.getUpdater().updateHeadRows(this.getHeadRows());e.getUpdater().updateMoreButton(this.getMoreButton());e.getUpdater().updatePagination(this.getPagination());if(e.getParam("SHOW_ROW_CHECKBOXES")){e.bindOnRowEvents()}e.bindOnMoreButtonEvents();e.bindOnClickPaginationLinks();e.bindOnClickHeader();e.bindOnCheckAll();e.updateCounterDisplayed();e.updateCounterSelected();if(e.getParam("ALLOW_ROWS_SORT")){e.rowsSortable.reinit()}if(e.getParam("ALLOW_COLUMNS_SORT")){e.colsSortable.reinit()}i.unload();e.tableUnfade();e.replaceState(i.getLink());e.oldGrid.InitTable();e.bindOnClickOnRowActionsMenu();BX.onCustomEvent(window,"Grid::updated",[])})}},_clickOnMoreButton:function(t){t.preventDefault();var e=this;var i=this.getMoreButton();i.load();this.getData().request(i.getLink(),null,null,"more",function(){e.getUpdater().appendBodyRows(this.getBodyRows());e.getUpdater().updateMoreButton(this.getMoreButton());e.getUpdater().updatePagination(this.getPagination());if(e.getParam("SHOW_ROW_CHECKBOXES")){e.bindOnRowEvents()}e.bindOnMoreButtonEvents();e.bindOnClickPaginationLinks();e.bindOnClickHeader();e.bindOnCheckAll();e.updateCounterDisplayed();e.updateCounterSelected();if(e.getParam("ALLOW_ROWS_SORT")){e.rowsSortable.reinit()}if(e.getParam("ALLOW_COLUMNS_SORT")){e.colsSortable.reinit()}e.replaceState(i.getLink());e.bindOnClickOnRowActionsMenu()})},getAjaxId:function(){return BX.data(this.getContainer(),this.settings.get("ajaxIdDataProp"))},update:function(t,e){var i,n,s,a,r,o;if(!BX.type.isNotEmptyString(t)){return}a=BX.findChild(this.getTable(),{tag:"tbody"},true,false);r=BX.findChild(this.getTable(),{tag:"thead"},true,false);o=BX.findChild(this.getContainer(),{"class":this.settings.get("classNavPanel")},true,false);t=BX.create("div",{html:t});n=BX.findChild(t,{"class":this.settings.get("classHeadRow")},true,true);i=BX.findChild(t,{"class":this.settings.get("classDataRows")},true,true);s=BX.findChild(t,{"class":this.settings.get("classNavPanel")},true,false);if(e===this.settings.get("updateActionMore")){this.getRows().addRows(i);this.unselectAllCheckAllCheckboxes()}if(e===this.settings.get("updateActionPagination")){BX.cleanNode(a);this.getRows().addRows(i);this.unselectAllCheckAllCheckboxes()}if(e===this.settings.get("updateActionSort")){BX.cleanNode(r);BX.cleanNode(a);r.appendChild(n[0]);this.getRows().addRows(i)}o.innerHTML=s.innerHTML;if(this.getParam("SHOW_ROW_CHECKBOXES")){this.bindOnRowEvents()}this.bindOnMoreButtonEvents();this.bindOnClickPaginationLinks();this.bindOnClickHeader();this.bindOnCheckAll();this.updateCounterDisplayed();this.updateCounterSelected();this.sortable.reinit()},getCounterDisplayed:function(){return BX.findChild(this.getContainer(),{"class":this.settings.get("classCounterDisplayed")},true,false)},getCounterSelected:function(){return BX.findChild(this.getContainer(),{"class":this.settings.get("classCounterSelected")},true,false)},updateCounterDisplayed:function(){var t=this.getCounterDisplayed();if(BX.type.isDomNode(t)){this.getCounterDisplayed().innerText=this.getRows().getCountDisplayed()}},updateCounterSelected:function(){var t=this.getCounterSelected();if(BX.type.isDomNode(t)){this.getCounterSelected().innerText=this.getRows().getCountSelected()}},getContainerId:function(){return this.containerId},getId:function(){return this.containerId},getContainer:function(){return BX(this.getContainerId())},getScrollContainer:function(){this.scrollContainer=this.scrollContainer||BX.findChild(this.getContainer(),{"class":this.settings.get("classScrollContainer")},true,false);return this.scrollContainer},getWrapper:function(){this.wrapper=this.wrapper||BX.findChild(this.getContainer(),{"class":this.settings.get("classWrapper")},true,false);return this.wrapper},getFadeContainer:function(){this.fadeContainer=this.fadeContainer||BX.findChild(this.getContainer(),{"class":this.settings.get("classFadeContainer")},true,false);return this.fadeContainer},getTable:function(){return BX.findChild(this.getContainer(),{"class":this.settings.get("classTable")},true,false)},getHeaders:function(){return BX.findChild(this.getScrollContainer(),{className:"main-grid-header","data-relative":this.getContainerId},true,true)},getHead:function(){return BX.findChild(this.getTable(),{tag:"thead"},true,false)},getBody:function(){return BX.findChild(this.getTable(),{tag:"tbody"},true,false)},getFoot:function(){return BX.findChild(this.getTable(),{tag:"tfoot"},true,false)},getRows:function(){return new GridRows(this)},getMoreButton:function(){return new GridElement(BX.findChild(this.getContainer(),{"class":this.settings.get("classMoreButton")},true,false),this)}};BX.Main.gridManager={data:[],push:function(t,e,i){if(BX.type.isNotEmptyString(t)&&e){var n={id:t,instance:e,old:i||null};if(this.getById(t)===null){this.data.push(n)}else{this.data[0]=n}}},getById:function(t){var e=this.data.filter(function(e){return e.id===t||e.id.replace("main_grid_","")===t});return e.length===1?e[0]:null},getInstanceById:function(t){var e=this.getById(t);return BX.type.isPlainObject(e)?e["instance"]:null},reload:function(t){var e=this.getInstanceById(t);if(e){e.reload()}}}})();(function(t){t.namespace("BX.Main");t.Main.dropdown=function(t){this.id=null;this.dropdown=null;this.items=null;this.value=null;this.menuId=null;this.menu=null;this.menuItems=null;this.dataItems="items";this.dataValue="value";this.dropdownItemClass="main-dropdown-item";this.activeClass="main-dropdown-active";this.selectedClass="main-dropdown-item-selected";this.notSelectedClass="main-dropdown-item-not-selected";this.menuItemClass="menu-popup-item";this.init(t)};t.Main.dropdown.prototype={init:function(e){this.id=e.id;this.dropdown=e;this.items=this.getItems();this.value=this.getValue();this.menuId=this.getMenuId();this.menu=this.createMenu();this.menu.popupWindow.show();t.bind(this.dropdown,"click",t.delegate(this.showMenu,this))},getMenuId:function(){return this.id+"_menu"},getItems:function(){var e;var i;try{i=t.data(this.dropdown,this.dataItems);e=JSON.parse(i)}catch(n){e=[]}return e},getValue:function(){return t.data(this.dropdown,this.dataValue)},prepareMenuItems:function(){var e=this;var i,n;var s=this.getValue();return this.getItems().map(function(a){i={};i["data-"+e.dataValue]=a.VALUE;n=t.create("div",{children:[t.create("span",{props:{className:e.dropdownItemClass},attrs:i,text:a.NAME})]});return{text:n.innerHTML,className:s===a.VALUE?e.selectedClass:e.notSelectedClass,delimiter:a.SEPORATOR}})},createMenu:function(){var e=this;return t.PopupMenu.create(this.getMenuId(),this.dropdown,this.prepareMenuItems(),{autoHide:true,offsetTop:-8,offsetLeft:40,angle:{position:"bottom",offset:0},events:{onPopupClose:t.delegate(this._onCloseMenu,this),onPopupShow:function(){e._onShowMenu()}}})},showMenu:function(){this.menu=t.PopupMenu.getMenuById(this.menuId);if(!this.menu){this.menu=this.createMenu();this.menu.popupWindow.show()}},getSubItem:function(e){return t.findChild(e,{"class":this.dropdownItemClass},true,false)},refresh:function(e){var i=this.getSubItem(e);var n=t.data(i,this.dataValue);this.dropdown.innerText=i.innerText;this.dropdown.dataset[this.dataValue]=n},selectItem:function(e){var i=this;(this.menu.menuItems||[]).forEach(function(n){t.removeClass(n.layout.item,i.selectedClass);if(e!==n.layout.item){t.addClass(n.layout.item,i.notSelectedClass)}else{t.removeClass(n.layout.item,i.notSelectedClass)}});t.addClass(e,this.selectedClass)},getDataItemIndexByValue:function(e,i){var n;if(t.type.isArray(e)){e.map(function(t,e){if(t.VALUE===i){n=e;return false}})}return false},getDataItemByValue:function(t){var e=this.getItems().filter(function(e){return e.VALUE===t});return e.length>0?e[0]:null},_onShowMenu:function(){var e=this;t.addClass(this.dropdown,this.activeClass);(this.menu.menuItems||[]).forEach(function(i){t.bind(i.layout.item,"click",t.delegate(e._onItemClick,e))})},_onCloseMenu:function(){t.removeClass(this.dropdown,this.activeClass);t.PopupMenu.destroy(this.menuId)},_onItemClick:function(e){var i=this.getMenuItem(e.target);var n,s;this.refresh(i);this.selectItem(i);this.menu.popupWindow.close();n=this.getValue();s=this.getDataItemByValue(n);t.onCustomEvent(window,"Dropdown::change",[this.dropdown.id,e,i,s,n])},getMenuItem:function(e){var i=e;if(!t.hasClass(i,this.menuItemClass)){i=t.findParent(i,{"class":this.menuItemClass})}return i}};t.Main.dropdownManager={dropdownClass:"main-dropdown",data:{},init:function(){var e=this;var i;var n;var s;t.bind(document,"click",t.delegate(function(n){if(t.hasClass(n.target,this.dropdownClass)){n.preventDefault();i=this.getById(n.target.id);if(i&&i.dropdown===n.target){e.push(n.target.id,this.getById(n.target.id))}else{e.push(n.target.id,new t.Main.dropdown(n.target))}}},this));t(t.delegate(function(){n=t.findChild(document,{className:this.dropdownClass},true,true);if(t.type.isArray(n)){n.forEach(function(n){i=e.getById(n.id);try{s=JSON.parse(t.data(n,"items"))}catch(a){}t.onCustomEvent(window,"Dropdown::load",[n.id,{},null,t.type.isArray(s)&&s.length?s[0]:[],t.data(n,"value")])})}},this))},push:function(t,e){this.data[t]=e},getById:function(t){return t in this.data?this.data[t]:null}};t(function(){t.Main.dropdownManager.init()})})(BX);(function(){"use strict";BX.namespace("BX.Main");BX.Main.submenu={data:[],init:function(t,e,i,n){this.id=e;this.anchor=t;this.menuItems=n;this.level=i;this.anchorRect=BX.pos(this.anchor);this.toggleMenu()},toggleMenu:function(){var t;var e;var i;var n=this.anchor.menu;var s=n?this.anchor.menu.popupWindow:null;if(n&&s.isShown()){t=s.bindOptions.left;this.data.forEach(function(n){i=n.popupWindow;e=i.bindOptions.left;if(t<=e){n.popupWindow.close()}})}else{BX.PopupMenu.destroy(this.id);this.anchor.menu=this.createMenu();this.pushMenu(this.anchor.menu);this.anchor.menu.popupWindow.adjustPosition(BX.pos(this.anchor));this.anchor.menu.popupWindow.show();n=this.anchor.menu;s=n.popupWindow;t=s.bindOptions.left;this.data.forEach(function(s){i=s.popupWindow;e=i.bindOptions.left;if(t<=e&&n.id!==s.id){s.popupWindow.close()}})}},pushMenu:function(t){var e=this.getMenu(t);if(t){if(e===null){this.data.push(t)}else{this.data[e]=t}}},getMenu:function(t){var e=null;this.data.forEach(function(i,n){if(i.id===t.id){e=n;return false}});return e},createMenu:function(){return BX.PopupMenu.create(this.id,this.anchor,this.menuItems,{autoHide:true,offsetTop:-(this.anchorRect.height/2+26),offsetLeft:this.anchorRect.width+4,angle:{position:"left",offset:this.anchorRect.height/2-8}})}}})();
//# sourceMappingURL=script.map.js