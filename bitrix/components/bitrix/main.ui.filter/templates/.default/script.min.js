(function(){"use strict";BX.namespace("BX.Main");var t,e,s,i,n;t=function(t,e){this.classField="main-ui-control-field";this.classFieldGroup="main-ui-control-field-group";this.classFieldLine="main-ui-filter-field-line";this.classFieldDelete="main-ui-delete";this.classControl="main-ui-control";this.classDateControl="main-ui-date";this.classDateInput="main-ui-date-input";this.classSelect="main-ui-select";this.classMultiSelect="main-ui-multi-select";this.classValueDelete="main-ui-control-value-delete";this.classAddField="main-ui-filter-field-add-item";this.classAddPresetField="main-ui-filter-new-filter";this.classAddPresetFieldInput="main-ui-filter-sidebar-edit-control";this.classAddPresetButton="main-ui-filter-add-item";this.classButtonsContainer="main-ui-filter-field-button-container";this.classSaveButton="main-ui-filter-save";this.classCancelButton="main-ui-filter-cancel";this.classMenuItem="main-ui-select-inner-item";this.classMenuItemText="main-ui-select-inner-item-element";this.classMenuMultiItemText="main-ui-select-inner-label";this.classMenuItemChecked="main-ui-checked";this.classSearchContainer="main-ui-filter-search";this.classDefaultPopup="popup-window";this.classPopupFieldList="main-ui-filter-popup-field-list";this.classPopupFieldList1Column="main-ui-filter-field-list-1-column";this.classPopupFieldList2Column="main-ui-filter-field-list-2-column";this.classPopupFieldList3Column="main-ui-filter-field-list-3-column";this.classFieldListItem="main-ui-filter-field-list-item";this.classSquareSearchInput="main-ui-square-search-item";this.classEditButton="main-ui-filter-add-edit";this.classPresetEdit="main-ui-filter-edit";this.classPresetNameEdit="main-ui-filter-edit-text";this.classPresetDeleteButton="main-ui-delete";this.classPresetDragButton="main-ui-filter-icon-grab";this.classPresetEditButton="main-ui-filter-icon-edit";this.classPresetEditInput="main-ui-filter-sidebar-item-input";this.classPresetOndrag="main-ui-filter-sidebar-item-ondrag";this.minSearchLength=3;this.classSquare="main-ui-square";this.classSquareDelete="main-ui-square-delete";this.classPresetsContainer="main-ui-filter-sidebar-item-container";this.classPreset="main-ui-filter-sidebar-item";this.classPresetCurrent="main-ui-filter-current-item";this.classFilterContainer="main-ui-filter-wrapper";this.classFileldControlList="main-ui-filter-field-container-list";this.classSearchSquare="main-ui-filter-search-square";this.classClearSearchValueButton="main-ui-delete";this.classSearchButton="main-ui-search";this.classRemoveAnimation="main-ui-remove-animation";this.classAnimationShow="main-ui-popup-show-animation";this.classAnimationClose="main-ui-popup-close-animation";this.searchContainerPostfix="_search_container";this.searchPostfix="_search";this.classButtonContainer="main-ui-filter-field-button-container";this.textPlaceholderWithFilter="�����";this.textPlaceholderWithoutFilter="����� + ������";this.generalTemplateId="";this.stringTemplateId="";this.dateTemplateId="";this.numberTemplateId="";this.selectTemplateId="";this.multiSelectTemplateId="";this.userTemplateId="";this.entityTemplateId="";this.squareTemplateId="";this.dateFieldTemplateId="";this.fieldLineTemplateId="";this.init(t,e)};t.prototype={init:function(t,e){var s=e.getParam("FILTER_ID");var i=e.types;this.generalTemplateId=s+"_GENERAL_template";this.squareTemplateId=s+"_SQUARE_template";this.stringTemplateId=s+"_"+i.STRING+"_template";this.dateTemplateId=s+"_"+i.DATE+"_template";this.dateFieldTemplateId=s+"_"+i.DATE+"_FIELD_template";this.fieldLineTemplateId=s+"_FIELD_LINE_template";this.numberTemplateId=s+"_"+i.NUMBER+"_template";this.selectTemplateId=s+"_"+i.SELECT+"_template";this.multiSelectTemplateId=s+"_"+i.MULTI_SELECT+"_template";this.userTemplateId=s+"_"+i.USER+"_template";this.entityTemplateId=s+"_"+i.ENTITY+"_template";this.mergeSettings(t)},mergeSettings:function(t){var e;var s=this;if(BX.type.isPlainObject(t)){e=Object.keys(t);e.forEach(function(e){if(!BX.type.isFunction(s[e])){s[e]=t[e]}})}}};i=function(t){this.parent=null;this.presets=null;this.container=null;this.addPresetField=null;this.addPresetFieldInput=null;this.init(t)};i.prototype={init:function(t){this.parent=t;this.bindOnPresetClick()},bindOnPresetClick:function(){var t=this.getPresets();var e=this;(t||[]).forEach(function(t){BX.bind(t,"click",BX.delegate(e._onPresetClick,e))})},getAddPresetField:function(){return n.getByClass(this.getContainer(),this.parent.settings.classAddPresetField)},getAddPresetFieldInput:function(){return n.getByClass(this.getAddPresetField(),this.parent.settings.classAddPresetFieldInput)},normalizePreset:function(t){if(!BX.hasClass(t,this.parent.settings.classPreset)){t=BX.findParent(t,{"class":this.parent.settings.classPreset},true,false)}return t},deactivateAllPresets:function(){var t=this.getPresets();var e=this;(t||[]).forEach(function(t){if(BX.hasClass(t,e.parent.settings.classPresetCurrent)){BX.removeClass(t,e.parent.settings.classPresetCurrent)}})},activatePreset:function(t){this.deactivateAllPresets();if(!BX.hasClass(t,this.parent.settings.classPresetCurrent)){BX.addClass(t,this.parent.settings.classPresetCurrent)}},getPresetId:function(t){return BX.data(t,"id")},_onPresetClick:function(t){var e;var s=t.target;var i=this.parent;var n=i.settings;var a=this.normalizePreset(t.target);if(BX.type.isDomNode(a)){if(BX.hasClass(s,n.classPresetEditButton)){this.enableEditPresetName(a,s)}else{if(!BX.hasClass(a,this.parent.settings.classAddPresetField)&&!BX.hasClass(t.target,this.parent.settings.classPresetDragButton)&&!BX.hasClass(t.target,this.parent.settings.classPresetDeleteButton)&&!BX.hasClass(t.target,this.parent.settings.classPresetEditInput)){e=this.getPresetId(a);this.activatePreset(a);this.applyPreset(e);i.applyFilter();i.closePopup();if(i.isAddPresetEnabled()){i.disableAddPreset()}}}}},getPresetInput:function(t){return BX.findChild(t,{"class":this.parent.settings.classPresetEditInput},true,false)},enableEditPresetName:function(t){var e=this.getPresetInput(t);BX.addClass(t,this.parent.settings.classPresetNameEdit);e.focus();e.value=e.value},disableEditPresetName:function(t){var e=this.getPresetInput(t);BX.removeClass(t,this.parent.settings.classPresetNameEdit);if(BX.type.isDomNode(e)){e.blur()}},getPreset:function(t){var e=this.parent.getParam("PRESETS").filter(function(e){return e.ID===t});return e.length!==0?e[0]:null},applyPreset:function(t){var e=this.getPreset(t);this.parent.getSearch().updatePreset(e);this.updatePresetFields(e)},resetPreset:function(){var t=this.parent.getFieldListContainer();if(BX.type.isDomNode(t)){BX.cleanNode(t)}},getFields:function(){var t=this.parent.getFieldListContainer();var e=null;var s;if(BX.type.isDomNode(t)){e=BX.findChild(t,{"class":this.parent.settings.classField},true,true);s=BX.findChild(t,{"class":this.parent.settings.classFieldGroup},true,true);(s||[]).forEach(function(t){e.push(t)})}return e},getField:function(t){var e=this.getFields();var s=null;var i,n;if(BX.type.isArray(e)&&e.length){n=e.filter(function(e){if(BX.type.isDomNode(e)){i=BX.data(e,"name")}return i===t.NAME},this);s=n.length>0?n[0]:null}return s},removeField:function(t){var e=this.getField(t);if(BX.type.isDomNode(e)){this.parent.getFields().deleteField(e,true)}},addField:function(t){var e,s,i;if(BX.type.isPlainObject(t)){e=this.parent.getFieldListContainer();i=this.parent.getControls();s=BX.type.isArray(i)?i[i.length-1]:null;if(BX.type.isDomNode(s)){if(s.nodeName!=="INPUT"){s=BX.findChild(s,{tag:"input"},true,false)}t.TABINDEX=parseInt(s.getAttribute("tabindex"))+1}else{t.TABINDEX=2}if(BX.type.isDomNode(e)){s=this.createControl(t);if(BX.type.isDomNode(s)){BX.append(s,e)}}}},createControl:function(t){var e;switch(t.TYPE){case this.parent.types.STRING:{e=this.parent.getFields().createInputText(t);break}case this.parent.types.SELECT:{e=this.parent.getFields().createSelect(t);break}case this.parent.types.MULTI_SELECT:{e=this.parent.getFields().createMultiSelect(t);break}case this.parent.types.NUMBER:{e=this.parent.getFields().createNumber(t);break}case this.parent.types.DATE:{e=this.parent.getFields().createDate(t);break}case this.parent.types.USER:{e=this.parent.getFields().createUser(t);break}case this.parent.types.ENTITY:{e=this.parent.getFields().createEntity(t);break}default:{break}}if(BX.type.isDomNode(e)){e.dataset.name=t.NAME}return e},updatePresetFields:function(t){var e,s;var i=[];if(BX.type.isPlainObject(t)&&"FIELDS"in t){e=t.FIELDS;(e||[]).forEach(function(t,e){t.TABINDEX=e+1;i.push(this.createControl(t))},this);if(i.length){s=this.parent.getFieldListContainer();BX.cleanNode(s);i.forEach(function(t){if(BX.type.isDomNode(t)){BX.append(t,s)}})}}},getCurrentPreset:function(){return BX.findChild(this.getContainer(),{"class":this.parent.settings.classPresetCurrent},true,false)},getCurrentPresetId:function(){var t=this.getCurrentPreset();var e=null;if(BX.type.isDomNode(t)){e=this.getPresetId(t)}return e},getCurrentPresetData:function(){var t=this.getCurrentPresetId();var e=null;if(BX.type.isNotEmptyString(t)){e=this.getPreset(t)}return e},getContainer:function(){return n.getByClass(this.parent.getFilter(),this.parent.settings.classPresetsContainer)},getPresets:function(){return n.getByClass(this.getContainer(),this.parent.settings.classPreset,true)}};s=function(t){this.parent=null;this.container=null;this.input=null;this.preset=null;this.init(t)};s.prototype={init:function(t){this.parent=t;BX.bind(this.getInput(),"input",BX.debounce(BX.delegate(this._onInput,this),150))},_onInput:function(t){var e=this.parent;var s=t.target;if(e.getPopup().isShown()){e.closePopup()}if(s.value.length>=e.settings.minSearchLength){e.applyFilter();this.isClear=false}else{if(!this.isClear){this.isClear=true;e.applyFilter(true,true)}}},getInput:function(){var t;if(!BX.type.isDomNode(this.input)){t=[this.parent.getParam("FILTER_ID",""),"_search"].join("");this.input=BX(t)}return this.input},getContainer:function(){var t;if(!BX.type.isDomNode(this.container)){t=[this.parent.getParam("FILTER_ID"),"_search_container"].join("");this.container=BX(t)}return this.container},adjustInputPaddings:function(){var t=this.getPreset();var e=this.getInput();var s,i,n;if(BX.type.isDomNode(t)&&BX.type.isDomNode(e)){BX.style(e,"padding-left","");i=parseInt(BX.style(e,"padding-left"));s=BX.pos(t,this.getContainer());n=parseFloat(window.getComputedStyle(t,"::after").getPropertyValue("width"))-1;BX.style(e,"padding-left",s.width+n+i+"px")}else{BX.style(e,"padding-left","")}},setInputPlaceholder:function(t){var e=this.getInput();e.placeholder=t},clearInput:function(){var t=this.getInput();if(BX.type.isDomNode(t)){t.value=null}},clearForm:function(){this.clearInput();this.removePreset()},setPreset:function(t){var e=this.getContainer();var s,i,n,a,r;if(BX.type.isDomNode(e)&&BX.type.isPlainObject(t)){s=this.parent.getTemplateValueLabel();i=s.replace("{{ID}}",t.ID).replace("{{TITLE}}",t.TITLE);n=this.parent.settings.classSquare;r=this.parent.settings.classSearchSquare;a=BX.create("div",{html:i});i=BX.findChild(a,{"class":n},true,false);BX.addClass(i,r);BX.prepend(i,e);this.adjustInputPaddings();this.setInputPlaceholder(this.parent.settings.textPlaceholderWithFilter)}},getPreset:function(){var t=this.getContainer();var e=this.parent.settings.classSquare;var s=null;if(BX.type.isDomNode(t)){s=BX.findChild(t,{"class":e},true,false)}return s},removePreset:function(){var t=this.getPreset();if(BX.type.isDomNode(t)){BX.remove(t);this.adjustInputPaddings();this.setInputPlaceholder(this.parent.settings.textPlaceholderWithoutFilter)}},updatePreset:function(t){this.removePreset();this.setPreset(t)}};BX.Main.ui.block["main-ui-control-field"]=function(t){var e,s;e={block:"main-ui-control-field",attrs:{"data-name":"name"in t?t.name:""},content:[]};if(BX.type.isArray(t.content)){t.content.forEach(function(t){e.content.push(t)})}else if(BX.type.isPlainObject(t.content)||BX.type.isNotEmptyString(t.content)){e.content.push(t.content)}if("deleteButton"in t&&t.deleteButton===true){s={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete"],tag:"span"}};e.content.push(s)}return e};BX.Main.ui.block["main-ui-control-field-group"]=function(t){return{block:"main-ui-control-field-group",attrs:{"data-name":"name"in t?t.name:""},content:"content"in t?t.content:""}};BX.Main.ui.block["date-group"]=function(t){var e,s;e={block:"main-ui-control-field-group",name:"name"?t.name:"",content:[]};s={block:"main-ui-control-field",content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:"value"in t?t.value:"",items:"items"in t?t.items:"",name:"name"in t?t.name:"",params:"params"in t?t.params:"",valueDelete:false}};e.content.push(s);if("content"in t&&BX.type.isArray(t.content)){t.content.forEach(function(t){e.content.push(t)})}if("content"in t&&(BX.type.isPlainObject(t.content)||BX.type.isNotEmptyString(t.content))){e.content.push(t.content)}return e};e=function(t){this.parent=null;this.init(t)};e.prototype={init:function(t){this.parent=t;BX.addCustomEvent(window,"UI::Select::change",BX.delegate(this._onDateTypeChange,this))},deleteField:function(t){BX.remove(t)},isFieldDelete:function(t){return BX.hasClass(t,this.parent.settings.classFieldDelete)},isField:function(t){return BX.hasClass(t,this.parent.settings.classField)},isFieldGroup:function(t){return BX.hasClass(t,this.parent.settings.classFieldGroup)},getField:function(t){var e;if(BX.type.isDomNode(t)){e=BX.findParent(t,{"class":this.parent.settings.classField},true,false);if(!BX.type.isDomNode(e)){e=BX.findParent(t,{"class":this.parent.settings.classFieldGroup},true,false)}}return e},getTemplateById:function(t){return BX.html(BX(t))},render:function(t,e){var s,i,n,a;if(BX.type.isPlainObject(e)&&BX.type.isNotEmptyString(t)){s=Object.keys(e);s.forEach(function(s){a="{{"+s+"}}";t=t.replace(new RegExp(a,"g"),e[s])});n=BX.create("div",{html:t});i=BX.findChild(n,{"class":this.parent.settings.classFieldGroup},true,false);if(!BX.type.isDomNode(i)){i=BX.findChild(n,{"class":this.parent.settings.classField},true,false)}if(!BX.type.isDomNode(i)){i=BX.findChild(n,{"class":this.parent.settings.classFieldLine},true,false)}}return i},createInputText:function(t){var e=this.getTemplateById(this.parent.settings.stringTemplateId);return this.render(e,t)},createSelect:function(t){return BX.decl({block:"main-ui-control-field",name:t.NAME,deleteButton:true,content:{block:this.parent.settings.classSelect,name:t.NAME,items:t.ITEMS,value:t.ITEMS[0],params:t.PARAMS,tabindex:t.TABINDEX,valueDelete:false}})},createMultiSelect:function(t){return BX.decl({block:"main-ui-control-field",name:t.NAME,deleteButton:true,content:{block:"main-ui-multi-select",name:t.NAME,tabindex:"TABINDEX"in t?t.TABINDEX:"",placeholder:"PLACEHOLDER"in t?t.PLACEHOLDER:"",items:"ITEMS"in t?t.ITEMS:[],value:"VALUE"in t?t.VALUE:[],params:"PARAMS"in t?t.PARAMS:{isMulti:true},valueDelete:true}})},_onDateTypeChange:function(t,e){var s={};var i=null;var n,a;if(BX.type.isPlainObject(e)&&"VALUE"in e){a=t.getParams();if(!BX.type.isPlainObject(a)){n=t.getNode().parentNode.parentNode;s.TABINDEX=t.getInput().getAttribute("tabindex");s.SUB_TYPES=t.getItems();s.SUB_TYPE=e;s.NAME=BX.data(t.getNode(),"name");i=this.createDate(s);BX.insertAfter(i,n);BX.remove(n)}}},createDate:function(t){var e,s,i,n,a;var r=this.parent.dateTypes;var l=r.SINGLE;if("SUB_TYPE"in t&&BX.type.isPlainObject(t.SUB_TYPE)){l=t.SUB_TYPE.VALUE}e={block:"date-group",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"SUB_TYPE"in t?t.SUB_TYPE:{},items:"SUB_TYPES"in t?t.SUB_TYPES:[],name:"NAME"in t?t.NAME:"",deleteButton:true,content:[]};if(l===r.SINGLE){n={block:"main-ui-control-field",content:{block:"main-ui-date",mix:["filter-type-single"],calendarButton:true,valueDelete:true,name:"NAME"in t?t.NAME:"",tabindex:"TABINDEX"in t?t.TABINDEX:""}};e.content.push(n)}if(l===r.AFTER){n={block:"main-ui-control-field",content:{block:"main-ui-date",mix:["filter-type-single"],calendarButton:true,valueDelete:true,name:"NAME"in t?t.NAME+"_after":"",tabindex:"TABINDEX"in t?t.TABINDEX:""}};e.content.push(n)}if(l===r.BEFORE){n={block:"main-ui-control-field",content:{block:"main-ui-date",mix:["filter-type-single"],calendarButton:true,valueDelete:true,name:"NAME"in t?t.NAME+"_before":"",tabindex:"TABINDEX"in t?t.TABINDEX:""}};e.content.push(n)}if(l===r.RANGE){s={block:"main-ui-control-field",content:{block:"main-ui-date",calendarButton:true,valueDelete:true,name:"NAME"in t?t.NAME+"_from":"",tabindex:"TABINDEX"in t?t.TABINDEX:""}};a={block:"main-ui-filter-field-line",content:{block:"main-ui-filter-field-line-item",tag:"span"}};i={block:"main-ui-control-field",content:{block:"main-ui-date",calendarButton:true,valueDelete:true,name:"NAME"in t?t.NAME+"_to":"",tabindex:"TABINDEX"in t?t.TABINDEX:""}};e.content.push(s);e.content.push(a);e.content.push(i)}return BX.decl(e)}};BX.Main.ui.block["sidebar-item"]=function(t){return{block:"main-ui-filter-sidebar-item",attrs:{"data-id":"id"in t?t.id:""},content:{block:"main-ui-filter-sidebar-item-text-container",tag:"span",content:{block:"main-ui-filter-sidebar-item-text",tag:"span",content:"text"in t?t.text:""}}}};BX.Main.filter=function(t,e,s,i){this.params=null;this.search=null;this.popup=null;this.presets=null;this.fields=null;this.types=null;this.dateTypes=null;this.settings=null;this.filter=null;this.isAddPresetModeState=false;this.init(t,e,s,i)};BX.Main.filter.prototype={init:function(e,s,i,n){try{this.params=JSON.parse(e);this.types=JSON.parse(i);this.dateTypes=JSON.parse(n);this.settings=new t(s,this);this.getSearch().adjustInputPaddings();BX.bind(document,"click",BX.delegate(this._onDocumentClick,this));BX.bind(this.getSearch().getContainer(),"click",BX.delegate(this._onSearchContainerClick,this));if(this.getParam("GRID_ID")){BX.addCustomEvent("Grid::ready",BX.delegate(this._onGridReady,this))}}catch(a){throw a}},getPresetValues:function(){var t=this.getPreset().getFields();if(BX.type.isArray(t)&&t.length){t.forEach(function(t){})}},savePreset:function(){},updatePreset:function(){var t,e,s,i,n;var a=this.getPreset().getCurrentPresetId();var r=this.getPreset().getCurrentPresetData();var l=this.getPreset().getFields();var o=(l||[]).map(function(t){i=BX.data(t,"name");n=n||{};n[i]="";return i},this);s=o.length?o.join(","):"";t={name:r.TITLE,filter_id:a,filter_rows:s,fields:n};e={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};this.saveOptions(t,e)},saveOptions:function(t,e){var s=BX.util.add_url_param(this.getParam("SETTINGS_URL"),e||{});BX.ajax.post(s,t)},prepareEvent:function(t){var e,s;if(!("path"in t)||!t.path.length){t.path=[t.target];e=0;while((s=t.path[e++].parentNode)!=null){t.path.push(s)}}return t},_onDocumentClick:function(t){var e,s,i;var n=this.getPopup();var a=this.getFieldsPopup();if(n&&n.isShown()){t=this.prepareEvent(t);e=(t.path||[]).some(function(t){s=false;if(BX.type.isDomNode(t)){s=BX.hasClass(t,this.settings.classFilterContainer)||BX.hasClass(t,this.settings.classSearchContainer)||BX.hasClass(t,this.settings.classDefaultPopup)}return s},this);if(!e){this.closePopup()}}if(a&&a.isShown()){i=(t.path||[]).some(function(t){s=false;if(BX.type.isDomNode(t)){s=BX.hasClass(t,this.settings.classFieldListItem)||BX.hasClass(t,this.settings.classPopupFieldList)}return s},this);if(!i){this.closeFieldListPopup()}}},_onAddFieldClick:function(t){var e=this.getFieldsPopup();t.stopPropagation();if(e&&!e.isShown()){this.showFieldsPopup()}else{this.closeFieldListPopup()}},getFieldListPopupItems:function(){var t,e;var s=this.getParam("FIELDS");var i=BX.create("div",{props:{className:this.settings.classPopupFieldList}});if(BX.type.isArray(s)&&s.length){if(s.length<6){BX.addClass(i,this.settings.classPopupFieldList1Column)}if(s.length>6&&s.length<12){BX.addClass(i,this.settings.classPopupFieldList2Column)}if(s.length>12){BX.addClass(i,this.settings.classPopupFieldList3Column)}s.forEach(function(s){e=BX.create("div",{props:{className:[this.settings.classMenuItem,this.settings.classFieldListItem].join(" ")},attrs:{"data-item":JSON.stringify(s)}});t=BX.create("div",{props:{className:this.settings.classMenuMultiItemText},text:s.PLACEHOLDER});BX.append(t,e);BX.append(e,i);BX.bind(e,"click",BX.delegate(this._clickOnFieldListItem,this))},this)}return i},_clickOnFieldListItem:function(t){var e=t.target;var s;if(!BX.hasClass(e,this.settings.classFieldListItem)){e=BX.findParent(e,{"class":this.settings.classFieldListItem},true,false)}if(BX.type.isDomNode(e)){try{s=JSON.parse(BX.data(e,"item"))}catch(i){}if(BX.hasClass(e,this.settings.classMenuItemChecked)){BX.removeClass(e,this.settings.classMenuItemChecked);this.getPreset().removeField(s)}else{if(BX.type.isPlainObject(s)){this.getPreset().addField(s);BX.addClass(e,this.settings.classMenuItemChecked)}}if(!this.isAddPresetEnabled()){this.updatePreset()}}},showFieldsPopup:function(){var t=this.getFieldsPopup();this.adjustFieldListPopupPosition();t.show()},closeFieldListPopup:function(){var t=this.getFieldsPopup();t.close()},adjustFieldListPopupPosition:function(){var t=this.getFieldsPopup();var e=BX.pos(this.getAddField());e.forceBindPosition=true;t.adjustPosition(e)},getFieldsPopup:function(){var t=this.getAddField();if(!this.fieldsPopup){this.fieldsPopup=new BX.PopupWindow(this.getParam("FILTER_ID")+"_fields_popup",t,{autoHide:false,offsetTop:4,offsetLeft:0,lightShadow:true,closeIcon:false,closeByEsc:false,noAllPaddings:true,zIndex:13});this.fieldsPopup.setContent(this.getFieldListPopupItems())}return this.fieldsPopup},_onAddPresetClick:function(){this.enableAddPreset()},_onSaveButtonClick:function(){if(this.isEditEnabled()||this.isAddPresetEnabled()){this.savePreset();this.disableEdit();this.disableAddPreset()}},_onCancelButtonClick:function(){this.disableAddPreset();this.getPreset().getAddPresetFieldInput().value="";this.disableEdit()},_onGridReady:function(t){if(!this.grid&&t.getContainerId()===this.getParam("GRID_ID")){this.grid=t}},_onFilterClick:function(t){var e=this.getFields();var s=t.target;var i,n;if(e.isFieldDelete(s)){i=e.getField(s);e.deleteField(i)}if(BX.hasClass(s,this.settings.classValueDelete)||BX.hasClass(s.parentNode,this.settings.classValueDelete)){i=e.getField(s);if(BX.type.isDomNode(i)){n=BX.findChild(i,{"class":this.settings.classControl},true,false);if(BX.type.isDomNode(n)){if(n.tagName==="INPUT"&&n.type==="text"){n.value=""}}}}},getButtonsContainer:function(){return n.getByClass(this.getFilter(),this.settings.classButtonsContainer)},getSaveButton:function(){return n.getByClass(this.getFilter(),this.settings.classSaveButton)},getCancelButton:function(){return n.getByClass(this.getFilter(),this.settings.classCancelButton)},getAddPresetButton:function(){return n.getByClass(this.getFilter(),this.settings.classAddPresetButton)},isAddPresetEnabled:function(){return this.isAddPresetModeState},enableAddPreset:function(){var t=this.getPreset();var e=t.getAddPresetField();var s=t.getAddPresetFieldInput();var i=this.getButtonsContainer();BX.show(e);BX.show(i);if(BX.type.isDomNode(s)){s.focus()}this.isAddPresetModeState=true},disableAddPreset:function(){var t=this.getPreset();var e=t.getAddPresetField();var s=this.getButtonsContainer();var i=t.getCurrentPresetId();BX.hide(e);BX.hide(s);if(BX.type.isNotEmptyString(i)){t.applyPreset(i)}this.isAddPresetModeState=false},getControls:function(){var t=this.getFieldListContainer();var e=null;if(BX.type.isDomNode(t)){e=BX.findChild(t,{"class":this.settings.classControl},true,true)}return e},getControlValues:function(){var t=this.getControls();var e={};var s,i,n,a;t.forEach(function(t){if(!BX.hasClass(t,this.settings.classDateControl)){if("value"in t){s=t.value}else{s=BX.data(t,"value");try{s=JSON.parse(s)}catch(a){}if(BX.hasClass(t,this.settings.classSelect)){s=s.VALUE}}i=t.getAttribute("name");if(!BX.type.isNotEmptyString(i)){i=BX.data(t,"name")}}else{n=BX.findChild(t,{"class":this.settings.classDateInput},true,false);i=n.getAttribute("name");s=n.value}e[i]=s},this);a=this.getSearch().getInput();i=a.getAttribute("name");s=a.value;e[i]=s;return e},applyFilter:function(t,e){var s=this.getControlValues();var i;if(t&&!e){i=Object.keys(s);i.forEach(function(t){if(t!=="FIND"){s[t]=""}},this)}if(t&&e){s.FIND=""}if(this.grid){this.grid.reloadTable("POST",s)}BX.onCustomEvent(window,"Filter::apply",[this,s])},getAddField:function(){return n.getByClass(this.getFilter(),this.settings.classAddField)},getAddFieldInput:function(){return n.getByClass(this.getAddField(),this.settings.classAddPresetFieldInput)},getFieldListContainer:function(){return n.getByClass(this.getFilter(),this.settings.classFileldControlList)},getFields:function(){if(!(this.fields instanceof e)){this.fields=new e(this)}return this.fields},getPreset:function(){if(!(this.presets instanceof i)){this.presets=new i(this)}return this.presets},_onSearchContainerClick:function(t){var e=this.getSearch();var s,i;if(!BX.hasClass(t.target,this.settings.classSquareDelete)&&!BX.hasClass(t.target,this.settings.classClearSearchValueButton)&&!BX.hasClass(t.target,this.settings.classSearchButton)){if(!this.getPopup().isShown()){this.showPopup()}}else{if(BX.hasClass(t.target,this.settings.classSquareDelete)){e.removePreset();if(this.getPopup()){this.getPreset().deactivateAllPresets();if(!this.isAddPresetEnabled()){this.getPreset().resetPreset()}}e.getInput().focus();this.applyFilter(true);if(this.getPopup().isShown()){this.closePopup()}}if(BX.hasClass(t.target,this.settings.classClearSearchValueButton)){s=e.getPreset();i=e.getInput().value;if(s||i){e.clearForm();e.getInput().focus();this.getPreset().deactivateAllPresets();this.getPreset().resetPreset();this.applyFilter(true)}if(this.getPopup().isShown()){this.closePopup()}}if(BX.hasClass(t.target,this.settings.classSearchButton)){s=e.getPreset();i=e.getInput().value;if(!s||!i){e.getInput().focus()}if(this.getPopup().isShown()){this.closePopup()}}}},getTemplate:function(){return BX.html(BX(this.settings.generalTemplateId))},getTemplateValueLabel:function(){return BX.html(BX(this.settings.squareTemplateId))},closePopup:function(){var t=this.getPopup();var e=t.popupContainer;var s;BX.removeClass(e,this.settings.classAnimationShow);BX.addClass(e,this.settings.classAnimationClose);s=parseFloat(BX.style(e,"animation-duration"));if(BX.type.isNumber(s)){s=s*1e3}setTimeout(function(){t.close()},s)},showPopup:function(){var t=this.getPopup();var e=this;var s;if(!t.isShown()){t.show();s=t.popupContainer;BX.removeClass(s,this.settings.classAnimationClose);BX.addClass(s,e.settings.classAnimationShow)}},getPopup:function(){if(!(this.popup instanceof BX.PopupWindow)){this.popup=new BX.PopupWindow(this.getParam("FILTER_ID")+this.settings.searchContainerPostfix,this.getSearch().getContainer(),{autoHide:false,offsetTop:4,offsetLeft:0,lightShadow:true,closeIcon:false,closeByEsc:false,noAllPaddings:true,zIndex:12});this.popup.setContent(this.getTemplate());BX.bind(this.getFilter(),"click",BX.delegate(this._onFilterClick,this));BX.bind(this.getAddPresetButton(),"click",BX.delegate(this._onAddPresetClick,this));BX.bind(this.getSaveButton(),"click",BX.delegate(this._onSaveButtonClick,this));BX.bind(this.getCancelButton(),"click",BX.delegate(this._onCancelButtonClick,this));BX.bind(this.getAddField(),"click",BX.delegate(this._onAddFieldClick,this));BX.bind(this.getEditButton(),"click",BX.delegate(this._onEditButtonClick,this));this.getPreset()}return this.popup},_onEditButtonClick:function(){if(!this.isEditEnabled()){this.enableEdit()}else{this.disableEdit()}},enablePresetsDragAndDrop:function(){var t,e,s,i;t=this.getPreset();e=t.getPresets();this.presetsList=[];if(BX.type.isArray(e)&&e.length){e.forEach(function(e){i=t.getPresetId(e);if(!BX.hasClass(e,this.settings.classAddPresetField)&&i!=="default_filter"){s=this.getDragButton(e);s.onbxdragstart=BX.delegate(this._onDragStart,this);s.onbxdragstop=BX.delegate(this._onDragStop,this);s.onbxdrag=BX.delegate(this._onDrag,this);jsDD.registerObject(s);jsDD.registerDest(s);this.presetsList.push(e)}},this)}},getDragButton:function(t){return BX.findChild(t,{"class":this.settings.classPresetDragButton},true,false)},disablePresetsDragAndDrop:function(){if(BX.type.isArray(this.presetsList)&&this.presetsList.length){this.presetsList.forEach(function(t){if(!BX.hasClass(t,this.settings.classAddPresetField)){jsDD.unregisterObject(t);jsDD.unregisterDest(t)}},this)}},_onDragStart:function(){this.dragItem=this.getPreset().normalizePreset(jsDD.current_node);this.dragIndex=n.getIndex(this.presetsList,this.dragItem);this.dragRect=this.dragItem.getBoundingClientRect();this.offset=this.dragRect.height;this.dragStartOffset=jsDD.start_y-(this.dragRect.top+BX.scrollTop(window));n.styleForEach(this.list,{transition:"100ms"});BX.addClass(this.dragItem,this.settings.classPresetOndrag);BX.bind(document,"mousemove",BX.delegate(this._onMouseMove,this))},_onMouseMove:function(t){this.realX=t.clientX;this.realY=t.clientY},getDragOffset:function(){return jsDD.x-this.startDragOffset-this.dragRect.left},_onDragStop:function(){var t,e;BX.unbind(document,"mousemove",BX.delegate(this._onMouseMove,this));BX.removeClass(this.dragItem,this.settings.classPresetOndrag);n.styleForEach(this.presetsList,{transition:"",transform:""});n.collectionSort(this.dragItem,this.targetItem);t=this.getPreset();e=t.getPresets();this.presetsList=[];if(BX.type.isArray(e)&&e.length){e.forEach(function(t){if(!BX.hasClass(t,this.settings.classAddPresetField)){this.presetsList.push(t)}},this)}},_onDrag:function(){var t=this;var e,s;this.dragOffset=this.realY-this.dragRect.top-this.dragStartOffset;this.sortOffset=t.realY+BX.scrollTop(window);n.styleForEach([this.dragItem],{transition:"0ms",transform:"translate3d(0px, "+this.dragOffset+"px, 0px)"});this.presetsList.forEach(function(i,n){if(i){e=i.getBoundingClientRect();s=e.top+BX.scrollTop(window)+e.height/2;if(n>t.dragIndex&&t.sortOffset>s&&i.style.transform!=="translate3d(0px, "+-t.offset+"px, 0px)"&&i.style.transform!==""){t.targetItem=i;BX.style(i,"transform","translate3d(0px, "+-t.offset+"px, 0px)");BX.style(i,"transition","300ms")}if(n<t.dragIndex&&t.sortOffset<s&&i.style.transform!=="translate3d(0px, "+t.offset+"px, 0px)"&&i.style.transform!==""){t.targetItem=i;BX.style(i,"transform","translate3d(0px, "+t.offset+"px, 0px)");BX.style(i,"transition","300ms")}if((n<t.dragIndex&&t.sortOffset>s||n>t.dragIndex&&t.sortOffset<s)&&i.style.transform!=="translate3d(0px, 0px, 0px)"){if(i.style.transform!==""){t.targetItem=i}BX.style(i,"transform","translate3d(0px, 0px, 0px)");BX.style(i,"transition","300ms")}}})},enableEdit:function(){var t=this.getPreset();var e=t.getPresets();var s;if(BX.type.isArray(e)&&e.length){e.forEach(function(e){s=t.getPresetId(e);if(!BX.hasClass(e,this.settings.classAddPresetField)&&s!=="default_filter"){BX.addClass(e,this.settings.classPresetEdit)}},this)}this.enablePresetsDragAndDrop();BX.show(this.getButtonsContainer());this.isEditEnabledState=true},disableEdit:function(){var t=this.getPreset();var e=t.getPresets();if(BX.type.isArray(e)&&e.length){e.forEach(function(t){if(!BX.hasClass(t,this.settings.classAddPresetField)){BX.removeClass(t,this.settings.classPresetEdit);this.getPreset().disableEditPresetName(t)}},this)}this.disablePresetsDragAndDrop();if(!this.isAddPresetEnabled()){BX.style(this.getButtonsContainer(),"display","")}this.isEditEnabledState=false},isEditEnabled:function(){return this.isEditEnabledState},getEditButton:function(){return n.getByClass(this.getFilter(),this.settings.classEditButton)},getPopupOverlay:function(){var t=this.getPopup();return t.overlay.element},getParam:function(t,e){return this.params[t]?this.params[t]:e},getFilter:function(){return n.getByClass(document,this.settings.classFilterContainer)},getSearch:function(){if(!(this.search instanceof s)){this.search=new s(this)}return this.search}};n={cache:{},styleForEach:function(t,e){e=BX.type.isPlainObject(e)?e:null;var s=Object.keys(e);[].forEach.call(t||[],function(t){s.forEach(function(s){BX.style(t,s,e[s])})})},closestParent:function(t,e){if(t){if(!e){return t.parentNode||null;

}else{return BX.findParent(t,{"class":e})}}},closestChilds:function(t){if(t){return t.children||null}},getNext:function(t){if(t){return t.nextElementSibling||null}},getPrev:function(t){if(t){return t.previousElementSibling||null}},collectionSort:function(t,e){var s,i,n,a,r;if(t&&e&&t!==e&&t.parentNode===e.parentNode){s=this.closestParent(e);i=this.closestChilds(s);n=i.length;a=this.getIndex(i,t);r=this.getIndex(i,e);if(n===r){s.appendChild(e)}if(a>r){s.insertBefore(t,e)}if(a<r&&n!==r){s.insertBefore(t,this.getNext(e))}}},getIndex:function(t,e){return[].indexOf.call(t||[],e)},getByClass:function(t,e,s){s=BX.type.isBoolean(s)?s:false;if(!BX.type.isDomNode(this.cache[e])){this.cache[e]=BX.findChild(t,{"class":e},true,s)}return this.cache[e]}}})();(function(){BX.Main.filterManager={data:{},push:function(t,e){if(BX.type.isNotEmptyString(t)&&e){this.data[t]=e}},getById:function(t){var e=null;if(t in this.data){e=this.data[t]}return e}}})();
//# sourceMappingURL=script.map.js